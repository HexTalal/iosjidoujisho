var ni=Object.defineProperty;var oi=(t,e,n)=>e in t?ni(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Ne=(t,e,n)=>(oi(t,typeof e!="symbol"?e+"":e,n),n);import{S as ht,i as dt,n as mt,a0 as ii,e as Pt,a1 as ri,a as N,Q as At,f as B,ad as nn,h as ai,j as x,w as Be,s as se,k as $,l as ee,x as Ee,c as ue,m as K,ae as W,p as R,y as Fe,_ as We,d as Y,g as it,t as J,b as rt,z as De,af as yt,a2 as X,a8 as yn,ag as Rn,ac as U,O as re,a3 as Mn,q as _e,r as we,u as Ge,ah as In,ai as oe,aj as ie,o as uo,a6 as li,a7 as si,N as ui,ak as fi,a9 as fo,ab as An,aa as ci,C as hi}from"../../../chunks/singletons-54206af0.js";import{a as di,p as co,b as ho,i as mi,c as Yt,e as Rt,h as gi,j as ki,k as pi,l as tt,o as gt,s as Ot,m as Ae,n as on,F as Ye,q as mo,r as Ut,u as go,t as ot,v as ko,w as po,x as Ct,y as _n,z as wn,R as bi,A as Sn,V as Tt,B as bo,C as Ci,D as _i,E as wi,N as Si,G as Pi,H as et,f as On,d as Et,I as vi,S as yi,J as Ri,K as Mi,g as Bi,L as Ei,M as gn,O as Pn,P as vn,Q as Fi,T as Di,U as kn,W as pn,X as Ti,Y as Ii,Z as Ai,_ as Oi,$ as Li,a0 as Vi,a1 as zi,a2 as Hi,a3 as Ni,a4 as Gi,a5 as Wi,a6 as ji}from"../../../chunks/format-page-title-d410bd5f.js";import{p as Xi}from"../../../chunks/stores-41bc0127.js";import{p as Co,l as Jt,m as Lt,_ as Nt,q as qi,O as lt,i as bt,n as Yi,j as Ki,B as Qt,a as Xe,w as Ui,d as Ln}from"../../../chunks/dialog-manager-6307dd27.js";import{m as Ji,g as rn,t as Ze,a as _o,c as Vt,p as Vn,f as zn,b as Qi,i as wo}from"../../../chunks/index-cb88fc2b.js";import{F as at,f as zt,a as Zi,M as xi,m as Zt,b as $i,c as er,d as tr,e as nr,g as So}from"../../../chunks/merged-header-icon-3ae6f6f3.js";import{r as pt,a as or}from"../../../chunks/theme-option-56eff79b.js";import{i as Bn,d as Po}from"../../../chunks/utils-87ab534e.js";var It={schedule:function(t){var e=requestAnimationFrame,n=cancelAnimationFrame,i=It.delegate;i&&(e=i.requestAnimationFrame,n=i.cancelAnimationFrame);var o=e(function(r){n=void 0,t(r)});return new Co(function(){return n==null?void 0:n(o)})},requestAnimationFrame:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=It.delegate;return((n==null?void 0:n.requestAnimationFrame)||requestAnimationFrame).apply(void 0,Jt([],Lt(t)))},cancelAnimationFrame:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=It.delegate;return((n==null?void 0:n.cancelAnimationFrame)||cancelAnimationFrame).apply(void 0,Jt([],Lt(t)))},delegate:void 0},ir=function(t){Nt(e,t);function e(n,i){return t.call(this)||this}return e.prototype.schedule=function(n,i){return this},e}(Co),xt={setInterval:function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var o=xt.delegate;return o!=null&&o.setInterval?o.setInterval.apply(o,Jt([t,e],Lt(n))):setInterval.apply(void 0,Jt([t,e],Lt(n)))},clearInterval:function(t){var e=xt.delegate;return((e==null?void 0:e.clearInterval)||clearInterval)(t)},delegate:void 0},vo=function(t){Nt(e,t);function e(n,i){var o=t.call(this,n,i)||this;return o.scheduler=n,o.work=i,o.pending=!1,o}return e.prototype.schedule=function(n,i){var o;if(i===void 0&&(i=0),this.closed)return this;this.state=n;var r=this.id,a=this.scheduler;return r!=null&&(this.id=this.recycleAsyncId(a,r,i)),this.pending=!0,this.delay=i,this.id=(o=this.id)!==null&&o!==void 0?o:this.requestAsyncId(a,this.id,i),this},e.prototype.requestAsyncId=function(n,i,o){return o===void 0&&(o=0),xt.setInterval(n.flush.bind(n,this),o)},e.prototype.recycleAsyncId=function(n,i,o){if(o===void 0&&(o=0),o!=null&&this.delay===o&&this.pending===!1)return i;i!=null&&xt.clearInterval(i)},e.prototype.execute=function(n,i){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var o=this._execute(n,i);if(o)return o;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,i){var o=!1,r;try{this.work(n)}catch(a){o=!0,r=a||new Error("Scheduled action threw falsy error")}if(o)return this.unsubscribe(),r},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,i=n.id,o=n.scheduler,r=o.actions;this.work=this.state=this.scheduler=null,this.pending=!1,qi(r,this),i!=null&&(this.id=this.recycleAsyncId(o,i,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(ir),Hn=function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,i){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(i,n)},t.now=di.now,t}(),yo=function(t){Nt(e,t);function e(n,i){i===void 0&&(i=Hn.now);var o=t.call(this,n,i)||this;return o.actions=[],o._active=!1,o}return e.prototype.flush=function(n){var i=this.actions;if(this._active){i.push(n);return}var o;this._active=!0;do if(o=n.execute(n.state,n.delay))break;while(n=i.shift());if(this._active=!1,o){for(;n=i.shift();)n.unsubscribe();throw o}},e}(Hn),an=new yo(vo),rr=an,ar=function(t){Nt(e,t);function e(n,i){var o=t.call(this,n,i)||this;return o.scheduler=n,o.work=i,o}return e.prototype.requestAsyncId=function(n,i,o){return o===void 0&&(o=0),o!==null&&o>0?t.prototype.requestAsyncId.call(this,n,i,o):(n.actions.push(this),n._scheduled||(n._scheduled=It.requestAnimationFrame(function(){return n.flush(void 0)})))},e.prototype.recycleAsyncId=function(n,i,o){var r;if(o===void 0&&(o=0),o!=null?o>0:this.delay>0)return t.prototype.recycleAsyncId.call(this,n,i,o);var a=n.actions;i!=null&&((r=a[a.length-1])===null||r===void 0?void 0:r.id)!==i&&(It.cancelAnimationFrame(i),n._scheduled=void 0)},e}(vo),lr=function(t){Nt(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.flush=function(n){this._active=!0;var i=this._scheduled;this._scheduled=void 0;var o=this.actions,r;n=n||o.shift();do if(r=n.execute(n.state,n.delay))break;while((n=o[0])&&n.id===i&&o.shift());if(this._active=!1,r){for(;(n=o[0])&&n.id===i&&o.shift();)n.unsubscribe();throw r}},e}(yo),ln=new lr(ar),vt=new lt(function(t){return t.complete()});function En(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=co(t);return ho(t,n)}function sr(t){return t instanceof Date&&!isNaN(t)}var ur=["addListener","removeListener"],fr=["addEventListener","removeEventListener"],cr=["on","off"];function Ke(t,e,n,i){if(bt(n)&&(i=n,n=void 0),i)return Ke(t,e,n).pipe(Ji(i));var o=Lt(mr(t)?fr.map(function(l){return function(s){return t[l](e,s,n)}}):hr(t)?ur.map(Nn(t,e)):dr(t)?cr.map(Nn(t,e)):[],2),r=o[0],a=o[1];if(!r&&mi(t))return Yt(function(l){return Ke(l,e,n)})(Rt(t));if(!r)throw new TypeError("Invalid event target");return new lt(function(l){var s=function(){for(var u=[],c=0;c<arguments.length;c++)u[c]=arguments[c];return l.next(1<u.length?u:u[0])};return r(s),function(){return a(s)}})}function Nn(t,e){return function(n){return function(i){return t[n](e,i)}}}function hr(t){return bt(t.addListener)&&bt(t.removeListener)}function dr(t){return bt(t.on)&&bt(t.off)}function mr(t){return bt(t.addEventListener)&&bt(t.removeEventListener)}function sn(t,e,n){t===void 0&&(t=0),n===void 0&&(n=rr);var i=-1;return e!=null&&(gi(e)?n=e:i=e),new lt(function(o){var r=sr(t)?+t-n.now():t;r<0&&(r=0);var a=0;return n.schedule(function(){o.closed||(o.next(a++),0<=i?this.schedule(void 0,i):o.complete())},r)})}function gr(t,e){return t===void 0&&(t=0),e===void 0&&(e=an),t<0&&(t=0),sn(t,t,e)}function Gt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=co(t),i=ki(t,1/0),o=t;return o.length?o.length===1?Rt(o[0]):pi(i)(ho(o,n)):vt}var kr=Array.isArray;function pr(t){return t.length===1&&kr(t[0])?t[0]:t}function br(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t=pr(t),t.length===1?Rt(t[0]):new lt(Cr(t))}function Cr(t){return function(e){for(var n=[],i=function(r){n.push(Rt(t[r]).subscribe(tt(e,function(a){if(n){for(var l=0;l<n.length;l++)l!==r&&n[l].unsubscribe();n=null}e.next(a)})))},o=0;n&&!e.closed&&o<t.length;o++)i(o)}}function _r(t){return gt(function(e,n){var i=!1,o=null,r=null,a=function(){if(r==null||r.unsubscribe(),r=null,i){i=!1;var l=o;o=null,n.next(l)}};e.subscribe(tt(n,function(l){r==null||r.unsubscribe(),i=!0,o=l,r=tt(n,a,Yi),Rt(t(l)).subscribe(r)},function(){a(),n.complete()},void 0,function(){o=r=null}))})}function Ht(t,e){return e===void 0&&(e=an),gt(function(n,i){var o=null,r=null,a=null,l=function(){if(o){o.unsubscribe(),o=null;var u=r;r=null,i.next(u)}};function s(){var u=a+t,c=e.now();if(c<u){o=this.schedule(void 0,u-c),i.add(o);return}l()}n.subscribe(tt(i,function(u){r=u,a=e.now(),o||(o=e.schedule(s,t),i.add(o))},function(){l(),i.complete()},void 0,function(){r=o=null}))})}function Mt(t){return t<=0?function(){return vt}:gt(function(e,n){var i=0;e.subscribe(tt(n,function(o){++i<=t&&(n.next(o),t<=i&&n.complete())}))})}function Ro(t,e){return e===void 0&&(e=Ki),t=t??wr,gt(function(n,i){var o,r=!0;n.subscribe(tt(i,function(a){var l=e(a);(r||!t(o,l))&&(r=!1,o=l,i.next(a))}))})}function wr(t,e){return t===e}function Sr(t){return gt(function(e,n){try{e.subscribe(n)}finally{n.add(t)}})}function Pr(){return gt(function(t,e){var n,i=!1;t.subscribe(tt(e,function(o){var r=n;n=o,i&&e.next([r,o]),i=!0}))})}function vr(t,e){return e===void 0&&(e=!1),gt(function(n,i){var o=0;n.subscribe(tt(i,function(r){var a=t(r,o++);(a||e)&&i.next(r),!a&&i.complete()}))})}var Mo={leading:!0,trailing:!1};function yr(t,e){return e===void 0&&(e=Mo),gt(function(n,i){var o=e.leading,r=e.trailing,a=!1,l=null,s=null,u=!1,c=function(){s==null||s.unsubscribe(),s=null,r&&(f(),u&&i.complete())},p=function(){s=null,u&&i.complete()},g=function(C){return s=Rt(t(C)).subscribe(tt(i,c,p))},f=function(){if(a){a=!1;var C=l;l=null,i.next(C),!u&&g(C)}};n.subscribe(tt(i,function(C){a=!0,l=C,!(s&&!s.closed)&&(o?f():g(C))},function(){u=!0,!(r&&a&&s&&!s.closed)&&i.complete()}))})}function Rr(t,e,n){e===void 0&&(e=an),n===void 0&&(n=Mo);var i=sn(t,e);return yr(function(){return i},n)}const Fn=new Qt([]),$t=new Xe,Wt=new Xe,St=new Xe;function Bo(t){const e=t.filter(r=>!r.parentChapter);let n=t.find(r=>r.progress<100);n||(n=t[t.length-1]);const i=n.parentChapter||n.reference,o=e.findIndex(r=>r.reference===i);return[e,o,i]}function Mr(t){let e,n;return{c(){e=new ii(!1),n=Pt(),this.h()},l(i){e=ri(i,!1),n=Pt(),this.h()},h(){e.a=n},m(i,o){e.m(t[0],i,o),N(i,n,o)},p(i,[o]){o&1&&e.p(i[0])},i:At,o:At,d(i){i&&B(n),i&&e.d()}}}function Br(t,e,n){let{html:i}=e;const o=nn();return ai(()=>{o("load")}),t.$$set=r=>{"html"in r&&n(0,i=r.html)},[i]}class Eo extends ht{constructor(e){super(),dt(this,e,Br,Mr,mt,{html:0})}}function Er(t,e){var o;const n=(o=document.elementFromPoint(t,e))==null?void 0:o.closest("p");if(!n)return;const i=rn(n);if(!!i.length)return{range:Dn(i[0]),parent:n}}function Dn(t,e=0,n=0){const i=new Range;return i.setStart(t,e),i.setEnd(t,n),i}function Fr(t,e){var a,l,s;const n=(a=t.getSelection())!=null&&a.toString().trim()?(l=t.getSelection())==null?void 0:l.getRangeAt(0):void 0;let i;if(n?i=n:i=e,!i)return;const o=(s=i.endContainer.parentElement)==null?void 0:s.closest("p");if(!o)return;const r=rn(o);if(!!r.length)return Dn(r[0])}function Gn(t,e){const n=t.createRange();return n.selectNode(e),n.getBoundingClientRect()}function Fo(t,e=250){var n;(n=t.getSelection())==null||n.removeAllRanges(),setTimeout(()=>{var i;(i=t.getSelection())==null||i.addRange(new Range)},e)}function Do(t,e,n,i){const o=Math.min(Math.max(i,0),n?t.innerWidth/4:t.innerHeight/4),r=e.getBoundingClientRect(),a=n?o:r.left,l=n?t.innerWidth-o:r.right,s=n?r.top:o,u=n?r.bottom:t.innerHeight-o,c=Number(getComputedStyle(e).lineHeight.replace(/px$/,""));return{elLeftReferencePoint:a,elRightReferencePoint:l,elTopReferencePoint:s,elBottomReferencePoint:u,firstDimensionMargin:o,pointGap:c}}function Dt(t,e,n,i=0){if(!t)return;const o=`animate-[pulse_${n}s_cubic-bezier(0.4,0,0.6,1)_${i?"1":"infinite"}]`;t.classList[e](o),i&&setTimeout(()=>t.classList.remove(o),i)}class Dr{constructor(e,n,i,o,r=ln){Ne(this,"enabled$",new Qt(!1));this.multiplier=e,this.verticalMode=n,this.enabled$.pipe(Ot(a=>{if(!a)return vt;let l=0;return gr(0,r).pipe(Ae(()=>Date.now()),Pr(),Ae(s=>this.calcNewPos(s)),Ae(s=>{l+=s;const u=Math.trunc(l);return l-=u,u}),on(s=>s!==0))}),Ze(i)).subscribe(a=>{let l="top";n&&(l="left"),o.documentElement.scrollBy({[l]:a})})}toggle(){this.enabled$.next(!this.enabled$.getValue())}off(){this.enabled$.next(!1)}calcNewPos([e,n]){let i=.00365956;return this.verticalMode&&(i=-91489e-8),i*this.multiplier*(n-e)}}function _t(t,e){return e==="rtl"?-t:t}class Tr{constructor(e,n,i){this.calculator=e,this.window=n,this.firstDimensionMargin=i}scrollToBookmark(e,n=0){const i=this.getBookmarkPosition(e);if(!i)return;const{scrollToData:o}=Wn(i,this.firstDimensionMargin),r=this.calculator.verticalMode?"left":"top";o.left!==void 0&&r==="left"?o.left+=n:o.top!==void 0&&r==="top"&&(o.top-=n),this.window.scrollTo(o)}formatBookmarkData(e,n=0){const i=this.calculator.calcExploredCharCount(n),o=this.calculator.charCount,{verticalMode:r}=this.calculator,a=r?"scrollX":"scrollY";return{dataId:e,exploredCharCount:i,progress:i/o,[a]:this.window[a],lastBookmarkModified:new Date().getTime()}}formatBookmarkDataByRange(e){return this.formatBookmarkData(e)}getBookmarkBarPosition(e){const n=this.getBookmarkPosition(e);if(!!n)return Wn(n,this.firstDimensionMargin).bookmarkPosData}getBookmarkPosition(e){if(!e.exploredCharCount)return;const{verticalMode:n}=this.calculator,i=this.getBookmarkTargetPosByScrollValue(e);if(i)return i;const o=this.calculator.getScrollPosByCharCount(e.exploredCharCount);return n?{scrollX:o}:{scrollY:o}}getBookmarkTargetPosByScrollValue(e){const{exploredCharCount:n}=e,i=o=>{const r=e[o];if(!r)return;const a=_t(r,this.calculator.direction);if(this.calculator.getCharCountByScrollPos(a)===n)return{[o]:r}};return this.calculator.verticalMode?i("scrollX"):i("scrollY")}}function Wn(t,e){return"scrollX"in t?{scrollToData:{left:t.scrollX},bookmarkPosData:{right:`${-t.scrollX+e}px`}}:{scrollToData:{top:t.scrollY},bookmarkPosData:{top:`${t.scrollY+e}px`}}}function To(t){const e=(n,i,o,r)=>{if(o<i)return t??o;const a=Math.floor((i+o)/2);return n[a]===r?a:n[a]>r?e(n,i,a-1,r):e(n,a+1,o,r)};return(n,i)=>e(n,0,n.length-1,i)}function Ir(){const t=(e,n,i,o)=>{if(i<n)return-1;const r=Math.floor((n+i)/2);return o.intersectsNode(e[r])?r:o.comparePoint(e[r],0)>0?t(e,n,r-1,o):t(e,r+1,i,o)};return(e,n)=>t(e,0,e.length-1,n)}const Ar=Ir(),Or=To(-1),en=To(void 0);class Io{constructor(e,n,i,o,r){Ne(this,"charCount");Ne(this,"accumulatedCharCount");Ne(this,"paragraphPos");Ne(this,"paragraphs");Ne(this,"paragraphPosToAccCharCount",new Map);this.containerEl=e,this.axis=n,this.direction=i,this.scrollEl=o,this.document=r,this.paragraphs=rn(e),this.paragraphPos=Array(this.paragraphs.length),this.accumulatedCharCount=[];let a=0;this.paragraphs.forEach(l=>{a+=_o(l),this.accumulatedCharCount.push(a)}),this.charCount=a}get verticalMode(){return this.axis==="vertical"}updateParagraphPos(e=0){const n=this.scrollEl.getBoundingClientRect(),i=_t(this.verticalMode?n.right:n.top,this.direction),o=Number(getComputedStyle(this.containerEl)[this.verticalMode?"paddingRight":"paddingTop"].replace(/px$/,"")),r=new Map;for(let a=0;a<this.paragraphs.length;a+=1){const l=this.paragraphs[a],s=Gn(this.document,l),c=(()=>(this.verticalMode?s.width:s.height)<=0?this.paragraphPos[a-1]||0:_t(this.verticalMode?s.left:s.bottom,this.direction)-i-o+e)();this.paragraphPos[a]=c;const p=r.get(c)||[];r.set(c,p),p.push(a)}this.paragraphPosToAccCharCount=new Map(Array.from(r.entries()).map(([a,l])=>[a,Math.max(...l.map(s=>this.accumulatedCharCount[s]))]))}calcExploredCharCount(e=0){return this.getCharCountByScrollPos(this.scrollPos+e)}getCharCountByScrollPos(e){const n=en(this.paragraphPos,e);return this.paragraphPosToAccCharCount.get(this.paragraphPos[n])||0}getBookMarkPosForSection(e,n){const i=Math.max(0,Or(this.accumulatedCharCount,n-e));let o=i,r=this.processSectionBookmarkIteration(i,e,n);if(!r){for(let a=i+1,{length:l}=this.accumulatedCharCount;a<l;a+=1)if(r=this.processSectionBookmarkIteration(a,e,n),r){o=a;break}}return{bookmarkPos:r,node:r?this.paragraphs[o]:void 0,isFirstNode:o===0}}getScrollPosByCharCount(e){const n=en(this.accumulatedCharCount,e);return _t(this.paragraphPos[n],this.direction)||0}getCharCountToPoint(e){const n=Math.max(0,Ar(this.paragraphs,e));return this.accumulatedCharCount[n-1]||0}processSectionBookmarkIteration(e,n,i){const o=this.accumulatedCharCount[e]+n;let r;if(o>i){let a=this.paragraphs[e];a.parentElement&&(a=a.parentElement.closest("p")||a.parentElement);const{top:l,right:s,left:u}=Gn(this.document,a);r=this.axis==="horizontal"?{left:s}:{top:l,left:u}}return r}get scrollPos(){return _t(this.scrollEl[this.scrollPosProp],this.direction)}get scrollPosProp(){return this.verticalMode?"scrollLeft":"scrollTop"}}function Lr(t,e,n){const i=Hr(e,n)(t,"scrollLeft");return(o,r,a)=>{if(!Vr(o))return;const l=zr(o,r,a);i(-l),o.preventDefault()}}function Vr(t){return!(!t.deltaY||t.deltaX||t.altKey||t.shiftKey||t.ctrlKey||t.metaKey)}function zr(t,e,n){switch(t.deltaMode){case 0:return t.deltaY;case 1:return t.deltaY*e*1.75;default:return t.deltaY*n}}function Hr(t,e){return(n,i)=>{let o=!1,r=t[i],a=t[i];const l=()=>{o=!0;const s=Math.trunc((r-t[i])/n);if(t[i]!==a){o=!1;return}if(a+=s,t.scrollBy(s,0),Math.abs(s)>0){e(l);return}o=!1};return s=>{o||(r=t[i],a=t[i]),r+=s,o||e(l)}}}class Nr{constructor(e,n,i){this.verticalMode=e,this.firstDimensionMargin=n,this.window=i}nextPage(){this.scrollByPercent(.95)}prevPage(){this.scrollByPercent(-.95)}updateSectionDataByOffset(){}scrollTo(e){this.window.scrollTo({[this.verticalMode?"left":"top"]:e})}scrollByPercent(e){let n=this.window.innerHeight,i="top",o=1;this.verticalMode&&(n=this.window.innerWidth,i="left",o=-1);const r=n-this.firstDimensionMargin*2;this.window.scrollBy({[i]:r*e*o,behavior:"smooth"})}}const{document:Gr,window:Wr}=Rn;function jn(t){let e,n,i,o,r;return{c(){e=x("div"),i=se(),o=x("div"),this.h()},l(a){e=$(a,"DIV",{class:!0,style:!0}),ee(e).forEach(B),i=ue(a),o=$(a,"DIV",{class:!0,style:!0}),ee(o).forEach(B),this.h()},h(){K(e,"class","fixed z-[5]"),K(e,"style",n=t[22]+": 100%; "+t[21]+": "+t[15]+"px; "+t[20][0]+": 0"),W(e,"inset-y-0",t[2]),W(e,"inset-x-0",!t[2]),R(e,"background-color",t[4]),K(o,"class","fixed z-[5]"),K(o,"style",r=t[22]+": 100%; "+t[21]+": "+t[15]+"px; "+t[20][1]+": 0"),W(o,"inset-y-0",t[2]),W(o,"inset-x-0",!t[2]),R(o,"background-color",t[4])},m(a,l){N(a,e,l),N(a,i,l),N(a,o,l)},p(a,l){l[0]&7372800&&n!==(n=a[22]+": 100%; "+a[21]+": "+a[15]+"px; "+a[20][0]+": 0")&&K(e,"style",n),l[0]&4&&W(e,"inset-y-0",a[2]),l[0]&4&&W(e,"inset-x-0",!a[2]),l[0]&16&&R(e,"background-color",a[4]),l[0]&7372800&&r!==(r=a[22]+": 100%; "+a[21]+": "+a[15]+"px; "+a[20][1]+": 0")&&K(o,"style",r),l[0]&4&&W(o,"inset-y-0",a[2]),l[0]&4&&W(o,"inset-x-0",!a[2]),l[0]&16&&R(o,"background-color",a[4])},d(a){a&&B(e),a&&B(i),a&&B(o)}}}function Xn(t){let e,n,i,o;const r=[Xr,jr],a=[];function l(s,u){return s[2]?0:1}return e=l(t),n=a[e]=r[e](t),{c(){n.c(),i=Pt()},l(s){n.l(s),i=Pt()},m(s,u){a[e].m(s,u),N(s,i,u),o=!0},p(s,u){let c=e;e=l(s),e===c?a[e].p(s,u):(it(),J(a[c],1,1,()=>{a[c]=null}),rt(),n=a[e],n?n.p(s,u):(n=a[e]=r[e](s),n.c()),Y(n,1),n.m(i.parentNode,i))},i(s){o||(Y(n),o=!0)},o(s){J(n),o=!1},d(s){a[e].d(s),s&&B(i)}}}function jr(t){let e,n,i;return n=new at({props:{icon:zt}}),{c(){e=x("div"),Be(n.$$.fragment),this.h()},l(o){e=$(o,"DIV",{class:!0});var r=ee(e);Ee(n.$$.fragment,r),r.forEach(B),this.h()},h(){K(e,"class","pointer-events-none absolute text-sm opacity-25 sm:text-xl"),R(e,"color",t[3]),R(e,"left",t[17]),R(e,"top",`calc(${t[18].top} + 1.5rem)`)},m(o,r){N(o,e,r),Fe(n,e,null),i=!0},p(o,r){r[0]&8&&R(e,"color",o[3]),r[0]&131072&&R(e,"left",o[17]),r[0]&262144&&R(e,"top",`calc(${o[18].top} + 1.5rem)`)},i(o){i||(Y(n.$$.fragment,o),i=!0)},o(o){J(n.$$.fragment,o),i=!1},d(o){o&&B(e),De(n)}}}function Xr(t){let e,n,i;return n=new at({props:{icon:zt}}),{c(){e=x("div"),Be(n.$$.fragment),this.h()},l(o){e=$(o,"DIV",{class:!0});var r=ee(e);Ee(n.$$.fragment,r),r.forEach(B),this.h()},h(){K(e,"class","pointer-events-none absolute text-xl opacity-25"),R(e,"color",t[3]),R(e,"right",`calc(${t[18].right} + 1rem)`),R(e,"top",t[17])},m(o,r){N(o,e,r),Fe(n,e,null),i=!0},p(o,r){r[0]&8&&R(e,"color",o[3]),r[0]&262144&&R(e,"right",`calc(${o[18].right} + 1rem)`),r[0]&131072&&R(e,"top",o[17])},i(o){i||(Y(n.$$.fragment,o),i=!0)},o(o){J(n.$$.fragment,o),i=!1},d(o){o&&B(e),De(n)}}}function qr(t){let e,n,i=`${t[9]}px`,o=`${t[19]||t[1]}px`,r,a,l,s,u,c;n=new Eo({props:{html:t[0]}}),n.$on("load",t[25]);let p=t[15]&&jn(t),g=t[18]&&Xn(t);return{c(){e=x("div"),Be(n.$$.fragment),r=se(),p&&p.c(),a=se(),g&&g.c(),l=se(),this.h()},l(f){e=$(f,"DIV",{class:!0});var C=ee(e);Ee(n.$$.fragment,C),C.forEach(B),r=ue(f),p&&p.l(f),a=ue(f),g&&g.l(f),l=ue(f),this.h()},h(){K(e,"class","book-content m-auto svelte-1ouz3ba"),W(e,"book-content--writing-vertical-rl",t[2]),W(e,"book-content--writing-horizontal-rl",!t[2]),W(e,"book-content--hide-furigana",t[12]),W(e,"book-content--hide-spoiler-image",t[11]),W(e,"book-content--furigana-style-partial",t[13]===Ye.Partial),W(e,"book-content--furigana-style-full",t[13]===Ye.Full),W(e,"book-content--furigana-style-toggle",t[13]===Ye.Toggle),R(e,"color",t[3]),R(e,"font-size",i),R(e,"line-height",t[10]),R(e,"max-width",!t[2]&&t[14]?`${t[14]}px`:void 0),R(e,"max-height",t[19]?`${t[19]}px`:void 0),R(e,"padding-left",t[2]&&t[15]?`${t[15]}px`:void 0),R(e,"padding-right",t[2]&&t[15]?`${t[15]}px`:void 0),R(e,"padding-top",!t[2]&&t[15]?`${t[15]}px`:void 0),R(e,"padding-bottom",!t[2]&&t[15]?`${t[15]}px`:void 0),R(e,"--font-family-serif",t[7]),R(e,"--font-family-sans-serif",t[8]),R(e,"--book-content-hint-furigana-font-color",t[5]),R(e,"--book-content-hint-furigana-shadow-color",t[6]),R(e,"--book-content-child-height",o)},m(f,C){N(f,e,C),Fe(n,e,null),t[47](e),N(f,r,C),p&&p.m(f,C),N(f,a,C),g&&g.m(f,C),N(f,l,C),s=!0,u||(c=[We(Wr,"scroll",t[24]),We(Gr.body,"wheel",t[23],{passive:!1})],u=!0)},p(f,C){const v={};C[0]&1&&(v.html=f[0]),n.$set(v),(!s||C[0]&4)&&W(e,"book-content--writing-vertical-rl",f[2]),(!s||C[0]&4)&&W(e,"book-content--writing-horizontal-rl",!f[2]),(!s||C[0]&4096)&&W(e,"book-content--hide-furigana",f[12]),(!s||C[0]&2048)&&W(e,"book-content--hide-spoiler-image",f[11]),(!s||C[0]&8192)&&W(e,"book-content--furigana-style-partial",f[13]===Ye.Partial),(!s||C[0]&8192)&&W(e,"book-content--furigana-style-full",f[13]===Ye.Full),(!s||C[0]&8192)&&W(e,"book-content--furigana-style-toggle",f[13]===Ye.Toggle),C[0]&8&&R(e,"color",f[3]),C[0]&512&&i!==(i=`${f[9]}px`)&&R(e,"font-size",i),C[0]&1024&&R(e,"line-height",f[10]),C[0]&16388&&R(e,"max-width",!f[2]&&f[14]?`${f[14]}px`:void 0),C[0]&524288&&R(e,"max-height",f[19]?`${f[19]}px`:void 0),C[0]&32772&&R(e,"padding-left",f[2]&&f[15]?`${f[15]}px`:void 0),C[0]&32772&&R(e,"padding-right",f[2]&&f[15]?`${f[15]}px`:void 0),C[0]&32772&&R(e,"padding-top",!f[2]&&f[15]?`${f[15]}px`:void 0),C[0]&32772&&R(e,"padding-bottom",!f[2]&&f[15]?`${f[15]}px`:void 0),C[0]&128&&R(e,"--font-family-serif",f[7]),C[0]&256&&R(e,"--font-family-sans-serif",f[8]),C[0]&32&&R(e,"--book-content-hint-furigana-font-color",f[5]),C[0]&64&&R(e,"--book-content-hint-furigana-shadow-color",f[6]),C[0]&524290&&o!==(o=`${f[19]||f[1]}px`)&&R(e,"--book-content-child-height",o),f[15]?p?p.p(f,C):(p=jn(f),p.c(),p.m(a.parentNode,a)):p&&(p.d(1),p=null),f[18]?g?(g.p(f,C),C[0]&262144&&Y(g,1)):(g=Xn(f),g.c(),Y(g,1),g.m(l.parentNode,l)):g&&(it(),J(g,1,1,()=>{g=null}),rt())},i(f){s||(Y(n.$$.fragment,f),Y(g),s=!0)},o(f){J(n.$$.fragment,f),J(g),s=!1},d(f){f&&B(e),De(n),t[47](null),f&&B(r),p&&p.d(f),f&&B(a),g&&g.d(f),f&&B(l),u=!1,yt(c)}}}function Yr(t,e,n){let i,o,r,a,l,s;X(t,St,y=>n(53,l=y)),X(t,mo,y=>n(46,s=y));let{htmlContent:u}=e,{width:c}=e,{height:p}=e,{verticalMode:g}=e,{fontColor:f}=e,{backgroundColor:C}=e,{hintFuriganaFontColor:v}=e,{hintFuriganaShadowColor:k}=e,{fontFamilyGroupOne:P}=e,{fontFamilyGroupTwo:G}=e,{fontSize:D}=e,{lineHeight:M}=e,{hideSpoilerImage:I}=e,{hideFurigana:A}=e,{furiganaStyle:O}=e,{secondDimensionMaxValue:S}=e,{firstDimensionMargin:E}=e,{autoPositionOnResize:V}=e,{autoBookmark:d}=e,{loadingState:F}=e,{multiplier:w}=e,{bookmarkData:L}=e,{exploredCharCount:j}=e,{bookCharCount:Q}=e,{autoScroller:fe}=e,{bookmarkManager:te}=e,{pageManager:Se}=e,{customReadingPoint:ve}=e,{customReadingPointLeft:ce}=e,{customReadingPointTop:Pe}=e,{customReadingPointScrollOffset:z}=e;const be=nn();let q,de,Z={},me,ke,ye,_,T,ae=0,H=!1,Ce=window.matchMedia("(min-width: 640px)").matches?"0.5rem":"0.25rem";const pe=Lr(4,document.documentElement,requestAnimationFrame),Oe=new Xe,Ie=new Xe,Me=new Xe,Le=new Map,Ue=new Map;let Ve=0,je=!1;yn(()=>{Me.next(),Me.complete()}),me=new Dr(w,g,Me,document),fe=me,Vt([Oe,Ie]).pipe(on(()=>V),Ut(1),Ae(([y,he])=>g?he:y),Ro(),Ht(10),go(ln),Ze(Me)).subscribe(()=>{if(!de||!ye)return;const y=de.getScrollPosByCharCount(ae)+(g?z:-z);H=!0,ye.scrollTo(y)});function Te(){if(!s||!q)return;const{elLeftReferencePoint:y,elTopReferencePoint:he,elRightReferencePoint:ze,elBottomReferencePoint:Re,firstDimensionMargin:b,pointGap:ne}=Do(window,q,g,E);if(g){n(32,Pe=he),n(31,ce=Math.min(Math.max(b+(ze-y)*(ve/100)-2,y+ne),ze-2)),n(33,z=window.innerWidth-b-ce);return}n(32,Pe=Math.min(Math.max(b+(Re-he)*(ve/100),b),Re-ne*1.5)),n(31,ce=y),n(33,z=Pe-b)}function st(y){y.updateParagraphPos(),Te(),n(26,j=y.calcExploredCharCount(z)),T&&(T=!1,L.then(he=>{!he||!te||(ae=he.exploredCharCount||0,te.scrollToBookmark(he,z))}).finally(()=>{d&&Ke(window,"scroll").pipe(Ut(1),Ht(3e3),Ze(Me)).subscribe(()=>{be("bookmark")}),Fn.pipe(Mt(1),Ot(he=>he.length?(he.forEach(ze=>{const Re=ze.reference,b=document.getElementById(Re);b&&(Ve||(Ve=Number(getComputedStyle(b)[g?"marginLeft":"marginBottom"].replace(/px$/,""))/2),Ue.set(Re,{...ze,progress:0}),Le.set(Re,b))}),Le.size?(Je(),Ke(window,"scroll")):vt):vt),_r(()=>sn(je?100:500)),Ze(Me)).subscribe(Je)})),n(42,Z={})}function Je(){const y=[...Ue.entries()];for(let he=0,{length:ze}=y;he<ze;he+=1){const[Re,b]=y[he],le=Le.get(Re).getBoundingClientRect();b.progress=g?Math.min(Math.max(le.right+(E||0)-window.innerWidth+z,0),le.width)/(le.width||1)*100:Math.abs(Math.min(Math.max(le.top-(E||0)-z,-le.height),0))/(le.height||1)*100,Ue.set(Re,b)}je=!1,$t.next(Ue)}function ut(y){g&&!l&&pe(y,D,window.innerWidth)}function nt(){requestAnimationFrame(()=>{!de||(n(26,j=de.calcExploredCharCount(z)),!H&&j&&(ae=j),H=!1)})}function xe(){!q||(n(41,de=new Io(q,g?"vertical":"horizontal",g?"rtl":"ltr",document.documentElement,document)),n(26,j=0),ae=j,n(27,Q=de.charCount),be("contentChange",q))}Wt.pipe(Ze(Me)).subscribe(y=>{let he=document.getElementById(y);if(!he)return;he=!y.startsWith(Vn)&&he.closest(`div[id^="${Vn}"]`)||he,je=!0;const Re=he.getBoundingClientRect();g?window.scrollBy(-(window.innerWidth-Re.right-(E||0)-z-(!z||z&&Ve>z?Ve:0)),0):window.scrollBy(0,Re.top-(E||0)-z-(!z||z&&Ve>z?Ve:0))});function $e(y){U[y?"unshift":"push"](()=>{q=y,n(16,q)})}return t.$$set=y=>{"htmlContent"in y&&n(0,u=y.htmlContent),"width"in y&&n(34,c=y.width),"height"in y&&n(1,p=y.height),"verticalMode"in y&&n(2,g=y.verticalMode),"fontColor"in y&&n(3,f=y.fontColor),"backgroundColor"in y&&n(4,C=y.backgroundColor),"hintFuriganaFontColor"in y&&n(5,v=y.hintFuriganaFontColor),"hintFuriganaShadowColor"in y&&n(6,k=y.hintFuriganaShadowColor),"fontFamilyGroupOne"in y&&n(7,P=y.fontFamilyGroupOne),"fontFamilyGroupTwo"in y&&n(8,G=y.fontFamilyGroupTwo),"fontSize"in y&&n(9,D=y.fontSize),"lineHeight"in y&&n(10,M=y.lineHeight),"hideSpoilerImage"in y&&n(11,I=y.hideSpoilerImage),"hideFurigana"in y&&n(12,A=y.hideFurigana),"furiganaStyle"in y&&n(13,O=y.furiganaStyle),"secondDimensionMaxValue"in y&&n(14,S=y.secondDimensionMaxValue),"firstDimensionMargin"in y&&n(15,E=y.firstDimensionMargin),"autoPositionOnResize"in y&&n(35,V=y.autoPositionOnResize),"autoBookmark"in y&&n(36,d=y.autoBookmark),"loadingState"in y&&n(37,F=y.loadingState),"multiplier"in y&&n(38,w=y.multiplier),"bookmarkData"in y&&n(39,L=y.bookmarkData),"exploredCharCount"in y&&n(26,j=y.exploredCharCount),"bookCharCount"in y&&n(27,Q=y.bookCharCount),"autoScroller"in y&&n(28,fe=y.autoScroller),"bookmarkManager"in y&&n(29,te=y.bookmarkManager),"pageManager"in y&&n(30,Se=y.pageManager),"customReadingPoint"in y&&n(40,ve=y.customReadingPoint),"customReadingPointLeft"in y&&n(31,ce=y.customReadingPointLeft),"customReadingPointTop"in y&&n(32,Pe=y.customReadingPointTop),"customReadingPointScrollOffset"in y&&n(33,z=y.customReadingPointScrollOffset)},t.$$.update=()=>{if(t.$$.dirty[0]&4&&n(22,i=g?"height":"width"),t.$$.dirty[0]&4&&n(21,o=g?"width":"height"),t.$$.dirty[0]&4&&n(20,r=g?["left","right"]:["top","bottom"]),t.$$.dirty[1]&8&&Oe.next(c),t.$$.dirty[0]&2&&Ie.next(p),t.$$.dirty[0]&16388&&n(19,a=g&&S?S:void 0),t.$$.dirty[0]&212996&&S&&q){const y=Number(getComputedStyle(q)[g?"marginTop":"marginRight"].replace(/px$/,""));n(17,Ce=`min(max(calc(${`${y}px - ${Ce}`}), ${Ce}), ${y?`${y}px`:Ce})`)}if(t.$$.dirty[0]&1&&u&&(T=!0),t.$$.dirty[0]&2|t.$$.dirty[1]&1096&&de&&c&&p&&!F){const y=de;requestAnimationFrame(()=>{st(y)})}t.$$.dirty[0]&4|t.$$.dirty[1]&4224&&me&&(n(43,me.multiplier=w,me),n(43,me.verticalMode=g,me)),t.$$.dirty[0]&32768|t.$$.dirty[1]&9216&&de&&(n(44,ke=de&&new Tr(de,window,E||0)),n(29,te=ke)),t.$$.dirty[1]&10496&&Z&&(n(18,_=void 0),L.then(y=>{!y||n(18,_=ke==null?void 0:ke.getBookmarkBarPosition(y))})),t.$$.dirty[0]&32772|t.$$.dirty[1]&16384&&(n(45,ye=new Nr(g,E,window)),n(30,Se=ye)),t.$$.dirty[0]&65536|t.$$.dirty[1]&33280&&s&&q&&Number.isFinite(ve)&&(Te(),nt(),Je())},[u,p,g,f,C,v,k,P,G,D,M,I,A,O,S,E,q,Ce,_,a,r,o,i,ut,nt,xe,j,Q,fe,te,Se,ce,Pe,z,c,V,d,F,w,L,ve,de,Z,me,ke,ye,s,$e]}class Kr extends ht{constructor(e){super(),dt(this,e,Yr,qr,mt,{htmlContent:0,width:34,height:1,verticalMode:2,fontColor:3,backgroundColor:4,hintFuriganaFontColor:5,hintFuriganaShadowColor:6,fontFamilyGroupOne:7,fontFamilyGroupTwo:8,fontSize:9,lineHeight:10,hideSpoilerImage:11,hideFurigana:12,furiganaStyle:13,secondDimensionMaxValue:14,firstDimensionMargin:15,autoPositionOnResize:35,autoBookmark:36,loadingState:37,multiplier:38,bookmarkData:39,exploredCharCount:26,bookCharCount:27,autoScroller:28,bookmarkManager:29,pageManager:30,customReadingPoint:40,customReadingPointLeft:31,customReadingPointTop:32,customReadingPointScrollOffset:33},null,[-1,-1,-1])}}const Ur="px-4 md:px-8";function Jr(t){const e=Array.from(t.getElementsByTagName("img"));return new lt(n=>{const i=e.filter(r=>r.src).map(Qr);if(i.length<=0){n.next(!1),n.complete();return}const o=Vt(i).subscribe(()=>{n.next(!1),n.complete()});return n.next(!0),o})}function Qr(t){return t.complete?En(1):br(Ke(t,"load"),Ke(t,"error"))}function Zr(t,e){const n=xr(t),i=ea(t);return o=>Gt(n(o),$r(o,e),i(o))}function xr(t){return e=>{const n=Array.from(e.getElementsByTagName("a"));n.forEach(o=>{o.href=t.location.pathname+o.hash});const i=n.map(o=>tn(o).pipe(ot(()=>Wt.next(o.hash.substring(1)))));return Gt(...i)}}function $r(t,e){const n=e===Ye.Toggle,o=Array.from(t.getElementsByTagName("ruby")).map(r=>n?tn(r).pipe(ot(()=>{r.classList.toggle("reveal-rt")})):tn(r).pipe(Mt(1),ot(()=>{r.classList.add("reveal-rt")})));return Gt(...o)}function ea(t){return e=>{const i=Array.from(e.querySelectorAll("[data-ttu-spoiler-img]")).map(o=>{const r=t.createElement("span");return r.classList.add("spoiler-label"),r.setAttribute("aria-hidden","true"),r.innerText="SPOILER",o.appendChild(r),tn(o).pipe(Mt(1),ot(()=>{o.removeChild(r),o.removeAttribute("data-ttu-spoiler-img")}))});return Gt(...i)}}function tn(t){return Ke(t,"click").pipe(ot(e=>{e.preventDefault(),e.stopImmediatePropagation()}))}const ta=300,na=60,Ao="none";function Ft(t,e,n){return t.addEventListener(e,n),()=>t.removeEventListener(e,n)}function oa(t,e){return e.filter(n=>t.pointerId!==n.pointerId)}function jt(t,e,n,i,o){t.dispatchEvent(new CustomEvent(`${e}${o}`,{detail:{event:n,pointersCount:i.length}}))}function ia(t,e,n,i,o,r=Ao){e.style.touchAction=r;let a=[];function l(u){a.push(u),jt(e,t,u,a,"down"),i==null||i(a,u);const c=u.pointerId;function p(P){c===P.pointerId&&(a=oa(P,a),a.length||g(),jt(e,t,P,a,"up"),o==null||o(a,P))}function g(){f(),C(),v(),k()}const f=Ft(e,"pointermove",P=>{a=a.map(G=>P.pointerId===G.pointerId?P:G),jt(e,t,P,a,"move"),n==null||n(a,P)}),C=Ft(e,"lostpointercapture",P=>{p(P)}),v=Ft(e,"pointerup",P=>{p(P)}),k=Ft(e,"pointerleave",P=>{a=[],g(),jt(e,t,P,a,"up"),o==null||o(a,P)})}const s=Ft(e,"pointerdown",l);return{destroy:()=>{s()}}}function ra(t,e={timeframe:ta,minSwipeDistance:na,touchAction:Ao}){const n="swipe";let i,o,r,a;function l(u,c){o=c.clientX,r=c.clientY,i=Date.now(),u.length===1&&(a=c.target)}function s(u,c){if(c.type==="pointerup"&&u.length===0&&Date.now()-i<e.timeframe){const p=c.clientX-o,g=c.clientY-r,f=Math.abs(p),C=Math.abs(g);let v=null;f>=2*C&&f>e.minSwipeDistance?v=p>0?"right":"left":C>=2*f&&C>e.minSwipeDistance&&(v=g>0?"bottom":"top"),v&&t.dispatchEvent(new CustomEvent(n,{detail:{direction:v,target:a}}))}}return ia(n,t,null,l,s,e.touchAction)}class aa{constructor(e,n,i,o,r){this.calculator=e,this.pageManager=n,this.sectionReady$=i,this.sectionIndex$=o,this.setIntendedCharCount=r}scrollToBookmark(e){const n=e.exploredCharCount;if(!n)return;const i=this.calculator.getSectionIndexByCharCount(n),o=l=>{const s=l.getScrollPosByCharCount(n);this.pageManager.scrollTo(s,!1),this.setIntendedCharCount(n)};if(this.sectionIndex$.getValue()===i){o(this.calculator);return}const a=this.sectionReady$.subscribe(l=>{o(l),a.unsubscribe()});this.sectionIndex$.next(i)}formatBookmarkData(e){return this.formatBookmarkDataByRange(e,void 0)}formatBookmarkDataByRange(e,n){const i=this.calculator.calcExploredCharCount(n),o=this.calculator.charCount;return{dataId:e,exploredCharCount:i,progress:i/o,lastBookmarkModified:new Date().getTime()}}}class la{constructor(e,n,i,o,r,a,l,s,u,c,p){Ne(this,"translateX",0);Ne(this,"sectionData",new Map);this.contentEl=e,this.scrollEl=n,this.sections=i,this.sectionIndex$=o,this.virtualScrollPos$=r,this.width=a,this.height=l,this.pageGap=s,this.verticalMode=u,this.pageChange$=c,this.sectionRenderComplete$=p,Fn.pipe(Mt(1)).subscribe(g=>{!g.length||(g.forEach(f=>{this.sectionData.set(f.reference,{...f,progress:0})}),$t.next(this.sectionData))})}nextPage(){this.flipPage(1)}prevPage(){this.flipPage(-1)}updateSectionDataByOffset(e=0){var o,r;const n=this.verticalMode?this.height:this.width,i=this.virtualScrollPos$.getValue()/this.scrollEl[this.verticalMode?"scrollHeight":"scrollWidth"]*100;if(e){const l=(this.virtualScrollPos$.getValue()+n+this.pageGap)/this.scrollEl[this.verticalMode?"scrollHeight":"scrollWidth"]*100-i;this.updateSectionData((o=this.sections[this.sectionIndex$.getValue()])==null?void 0:o.id,i+l*e)}else this.updateSectionData((r=this.sections[this.sectionIndex$.getValue()])==null?void 0:r.id,i)}flipPage(e){const n=this.verticalMode?"scrollHeight":"scrollWidth",i=this.verticalMode?this.height:this.width,o=i+this.pageGap,r=!0;if(this.translateX){const p=()=>{this.contentEl.style.removeProperty("transform"),this.translateX=0};if(e<0){const g=this.translateX;p(),this.scrollToPos(-g-o,r);return}if(this.nextSection(r)){p();return}return}const a=0,l=this.scrollEl[n],s=this.virtualScrollPos$.getValue(),u=s+o*e,c=Math.ceil(u);if(c<a){if(s!==a){this.scrollToPos(a,r);return}this.prevSection(o,n,i,r);return}if(c>=l){this.nextSection(r);return}this.scrollOrTranslateToPos(u,l,i,r)}scrollTo(e,n){const i=this.verticalMode?"scrollHeight":"scrollWidth",o=this.verticalMode?this.height:this.width;this.scrollOrTranslateToPos(e,this.scrollEl[i],o,n)}prevSection(e,n,i,o){const r=this.sectionIndex$.getValue()-1;return r<0?!1:(this.updateSectionIndex(r).subscribe(()=>{const a=this.scrollEl[n];let l=e*(Math.ceil(a/e)-1);Math.ceil(l)>=a&&(l-=e),this.scrollOrTranslateToPos(l,a,i,o)}),!0)}nextSection(e){const n=this.sectionIndex$.getValue()+1;return n>=this.sections.length?!1:(this.updateSectionIndex(n).subscribe(()=>{var i,o;this.scrollToPos(0,e),this.updateSectionData((i=this.sections[n-1])==null?void 0:i.id,100,!1),this.updateSectionData((o=this.sections[n])==null?void 0:o.id,0)}),!0)}scrollOrTranslateToPos(e,n,i,o){var a;if(this.updateSectionData((a=this.sections[this.sectionIndex$.getValue()])==null?void 0:a.id,e/n*100),this.verticalMode){this.scrollToPos(e,o);return}if(e+i<=n){this.scrollToPos(e,o);return}this.translateXToPos(-e,o)}scrollToPos(e,n){this.virtualScrollPos$.next(e),this.scrollEl.scrollTo({[this.verticalMode?"top":"left"]:e}),this.pageChange$.next(n)}translateXToPos(e,n){this.virtualScrollPos$.next(-e),this.contentEl.style.transform=`translateX(${e}px)`,this.translateX=e,this.pageChange$.next(n)}updateSectionIndex(e){return new lt(n=>{if(this.sectionIndex$.getValue()===e){n.next(),n.complete();return}const i=this.sectionRenderComplete$.subscribe(o=>{o===e&&n.next(),n.complete(),i.unsubscribe()});return this.sectionIndex$.next(e),i})}updateSectionData(e,n,i=!0){if(!e||!this.sectionData.has(e))return;const o=[...this.sectionData.values()];let r=!1;o.forEach(a=>{const l=this.sectionData.get(a.reference),s=a.reference===e;s?l.progress=n:r?l.progress=0:l.progress=100,!r&&s&&(r=!0),this.sectionData.set(a.reference,l)}),i&&$t.next(this.sectionData)}}class sa{constructor(e,n,i,o,r,a,l,s,u){Ne(this,"charCount");Ne(this,"sectionAccCharCounts");Ne(this,"sectionIndex",-1);Ne(this,"calculator");this.containerEl=e,this.sections=n,this.virtualScrollPos$=i,this.getWidth=o,this.getHeight=r,this.getPageGap=a,this.verticalMode=l,this.scrollEl=s,this.document=u;const c=g=>rn(g).reduce((C,v)=>C+_o(v),0);let p=0;this.sectionAccCharCounts=n.map(g=>(p+=c(g),p)),this.charCount=p}updateCurrentSection(e){this.calculator=new Io(this.containerEl,this.verticalMode?"horizontal":"vertical","ltr",this.scrollEl,this.document),this.sectionIndex=e}updateParagraphPos(){!this.calculator||this.calculator.updateParagraphPos(this.virtualScrollPos$.getValue())}calcExploredCharCount(e){if(e&&this.calculator)return this.getSectionStartCount()+this.calculator.getCharCountToPoint(e);const n=this.verticalMode?0:-this.screenSize;return this.getCharCountByScrollPos(this.virtualScrollPos$.getValue()+n)}getCharCountByScrollPos(e){if(!this.calculator)return-1;const n=this.getSectionStartCount();return this.calculator.getCharCountByScrollPos(e)+n}getSectionIndexByCharCount(e){return en(this.sectionAccCharCounts,e)+1}getScrollPosByCharCount(e){if(!this.calculator)return-1;const n=this.getSectionStartCount(),i=this.sectionAccCharCounts[this.sectionIndex],o=e-n,r=e===i&&i-n>0;if(o<0||e>i||r)return-1;if(o===0)return 0;const a=en(this.calculator.accumulatedCharCount,o),{accumulatedCharCount:l,paragraphPos:s}=this.calculator,u=l[a];if(Number.isNaN(Number(s[a])))return-1;const c=(v,k)=>v>=k?k:l[v]>u?v:c(v+1,k),p=s[c(a+1,l.length-1)],{screenSize:g}=this,f=this.verticalMode?-1:0,C=g*(Math.ceil(p/g)+f);return _t(C,this.calculator.direction)}checkBookmarkOnScreen(e){const n=this.getScrollPosByCharCount(e),i=this.virtualScrollPos$.getValue();return n===i&&this.calculator?{isBookmarkScreen:!0,...this.calculator.getBookMarkPosForSection(this.getSectionStartCount(),e)}:{isBookmarkScreen:n===i,bookmarkPos:void 0,node:void 0,isFirstNode:!0}}getOffsetToRange(e,n){if(!e)return 0;const i=e.getBoundingClientRect();if(this.verticalMode)return 1-i.left/this.screenSizeMirrored;const o=Math.floor(100/n),r=Math.floor(this.screenSize/n),a=o*i.bottom/this.screenSizeMirrored;let l=a,s=0;for(let u=0;u<this.screenSize&&i.right>=u;u+=r)l=s*o+a,s+=1;return l/100}getSectionStartCount(){return this.sectionAccCharCounts[this.sectionIndex-1]||0}get screenSize(){return(this.verticalMode?this.getHeight():this.getWidth())+this.getPageGap()}get screenSizeMirrored(){return(this.verticalMode?this.getWidth():this.getHeight())+this.getPageGap()}}const{window:ua}=Rn;function qn(t){let e,n,i;return n=new at({props:{icon:Zi,spin:!0}}),{c(){e=x("div"),Be(n.$$.fragment),this.h()},l(o){e=$(o,"DIV",{class:!0});var r=ee(e);Ee(n.$$.fragment,r),r.forEach(B),this.h()},h(){K(e,"class","fixed inset-0 flex h-full w-full items-center justify-center text-7xl"),R(e,"color",t[4]),R(e,"background-color",t[5])},m(o,r){N(o,e,r),Fe(n,e,null),i=!0},p(o,r){r[0]&16&&R(e,"color",o[4]),r[0]&32&&R(e,"background-color",o[5])},i(o){i||(Y(n.$$.fragment,o),i=!0)},o(o){J(n.$$.fragment,o),i=!1},d(o){o&&B(e),De(n)}}}function Yn(t){let e,n,i;return n=new at({props:{icon:zt}}),{c(){e=x("div"),Be(n.$$.fragment),this.h()},l(o){e=$(o,"DIV",{class:!0});var r=ee(e);Ee(n.$$.fragment,r),r.forEach(B),this.h()},h(){K(e,"class","fixed h-3 w-3 text-base opacity-25 sm:text-xl"),R(e,"color",t[4]),R(e,"top",t[21]),R(e,"left",t[22]),R(e,"right",t[23])},m(o,r){N(o,e,r),Fe(n,e,null),i=!0},p(o,r){r[0]&16&&R(e,"color",o[4]),r[0]&2097152&&R(e,"top",o[21]),r[0]&4194304&&R(e,"left",o[22]),r[0]&8388608&&R(e,"right",o[23])},i(o){i||(Y(n.$$.fragment,o),i=!0)},o(o){J(n.$$.fragment,o),i=!1},d(o){o&&B(e),De(n)}}}function fa(t){let e,n,i,o=`${t[10]}px`,r=`${t[1]}px`,a=`${t[2]}px`,l=`${t[3]?t[1]:(t[1]+wt)/t[24]-wt}px`,s,u,c,p,g,f;i=new Eo({props:{html:t[20]}}),i.$on("load",t[25]);let C=!t[19]&&qn(t),v=t[0]&&Yn(t);return{c(){e=x("div"),n=x("div"),Be(i.$$.fragment),s=se(),C&&C.c(),u=se(),v&&v.c(),c=Pt(),this.h()},l(k){e=$(k,"DIV",{class:!0});var P=ee(e);n=$(P,"DIV",{class:!0});var G=ee(n);Ee(i.$$.fragment,G),G.forEach(B),P.forEach(B),s=ue(k),C&&C.l(k),u=ue(k),v&&v.l(k),c=Pt(),this.h()},h(){K(n,"class","book-content-container svelte-u9j5ct"),K(e,"class","book-content m-auto svelte-u9j5ct"),W(e,"book-content--avoid-page-break",t[15]),W(e,"book-content--writing-vertical-rl",t[3]),W(e,"book-content--writing-horizontal-rl",!t[3]),W(e,"book-content--hide-furigana",t[13]),W(e,"book-content--hide-spoiler-image",t[12]),W(e,"book-content--furigana-style-partial",t[14]===Ye.Partial),W(e,"book-content--furigana-style-full",t[14]===Ye.Full),W(e,"book-content--furigana-style-toggle",t[14]===Ye.Toggle),R(e,"color",t[4]),R(e,"font-size",o),R(e,"line-height",t[11]),R(e,"padding-top",!t[3]&&t[16]?`${t[16]}px`:void 0),R(e,"padding-bottom",!t[3]&&t[16]?`${t[16]}px`:void 0),R(e,"padding-left",t[3]&&t[16]?`${t[16]}px`:void 0),R(e,"padding-right",t[3]&&t[16]?`${t[16]}px`:void 0),R(e,"max-width",t[1]?`${t[1]}px`:void 0),R(e,"max-height",t[3]&&t[2]?`${t[2]}px`:void 0),R(e,"--font-family-serif",t[8]),R(e,"--font-family-sans-serif",t[9]),R(e,"--book-content-hint-furigana-font-color",t[6]),R(e,"--book-content-hint-furigana-shadow-color",t[7]),R(e,"--book-content-child-width",r),R(e,"--book-content-child-height",a),R(e,"--book-content-child-column-width",!t[3]&&t[24]===1?`${t[1]}px`:""),R(e,"--book-content-column-count",t[24]),R(e,"--book-content-image-max-width",l)},m(k,P){N(k,e,P),re(e,n),Fe(i,n,null),t[43](n),t[44](e),N(k,s,P),C&&C.m(k,P),N(k,u,P),v&&v.m(k,P),N(k,c,P),p=!0,g||(f=[We(ua,"keydown",t[27]),Mn(ra.call(null,e,{timeframe:500,minSwipeDistance:10,touchAction:"pan-y"})),We(e,"swipe",t[26])],g=!0)},p(k,P){const G={};P[0]&1048576&&(G.html=k[20]),i.$set(G),(!p||P[0]&32768)&&W(e,"book-content--avoid-page-break",k[15]),(!p||P[0]&8)&&W(e,"book-content--writing-vertical-rl",k[3]),(!p||P[0]&8)&&W(e,"book-content--writing-horizontal-rl",!k[3]),(!p||P[0]&8192)&&W(e,"book-content--hide-furigana",k[13]),(!p||P[0]&4096)&&W(e,"book-content--hide-spoiler-image",k[12]),(!p||P[0]&16384)&&W(e,"book-content--furigana-style-partial",k[14]===Ye.Partial),(!p||P[0]&16384)&&W(e,"book-content--furigana-style-full",k[14]===Ye.Full),(!p||P[0]&16384)&&W(e,"book-content--furigana-style-toggle",k[14]===Ye.Toggle),P[0]&16&&R(e,"color",k[4]),P[0]&1024&&o!==(o=`${k[10]}px`)&&R(e,"font-size",o),P[0]&2048&&R(e,"line-height",k[11]),P[0]&65544&&R(e,"padding-top",!k[3]&&k[16]?`${k[16]}px`:void 0),P[0]&65544&&R(e,"padding-bottom",!k[3]&&k[16]?`${k[16]}px`:void 0),P[0]&65544&&R(e,"padding-left",k[3]&&k[16]?`${k[16]}px`:void 0),P[0]&65544&&R(e,"padding-right",k[3]&&k[16]?`${k[16]}px`:void 0),P[0]&2&&R(e,"max-width",k[1]?`${k[1]}px`:void 0),P[0]&12&&R(e,"max-height",k[3]&&k[2]?`${k[2]}px`:void 0),P[0]&256&&R(e,"--font-family-serif",k[8]),P[0]&512&&R(e,"--font-family-sans-serif",k[9]),P[0]&64&&R(e,"--book-content-hint-furigana-font-color",k[6]),P[0]&128&&R(e,"--book-content-hint-furigana-shadow-color",k[7]),P[0]&2&&r!==(r=`${k[1]}px`)&&R(e,"--book-content-child-width",r),P[0]&4&&a!==(a=`${k[2]}px`)&&R(e,"--book-content-child-height",a),P[0]&16777226&&R(e,"--book-content-child-column-width",!k[3]&&k[24]===1?`${k[1]}px`:""),P[0]&16777216&&R(e,"--book-content-column-count",k[24]),P[0]&16777226&&l!==(l=`${k[3]?k[1]:(k[1]+wt)/k[24]-wt}px`)&&R(e,"--book-content-image-max-width",l),k[19]?C&&(it(),J(C,1,1,()=>{C=null}),rt()):C?(C.p(k,P),P[0]&524288&&Y(C,1)):(C=qn(k),C.c(),Y(C,1),C.m(u.parentNode,u)),k[0]?v?(v.p(k,P),P[0]&1&&Y(v,1)):(v=Yn(k),v.c(),Y(v,1),v.m(c.parentNode,c)):v&&(it(),J(v,1,1,()=>{v=null}),rt())},i(k){p||(Y(i.$$.fragment,k),Y(C),Y(v),p=!0)},o(k){J(i.$$.fragment,k),J(C),J(v),p=!1},d(k){k&&B(e),De(i),t[43](null),t[44](null),k&&B(s),C&&C.d(k),k&&B(u),v&&v.d(k),k&&B(c),g=!1,yt(f)}}}const Kn="overflow-hidden",wt=40;function ca(t,e,n){let i,o,r,a,l;X(t,St,b=>n(49,o=b)),X(t,ko,b=>n(50,r=b)),X(t,Bn,b=>n(51,a=b)),X(t,po,b=>n(52,l=b));let{htmlContent:s}=e,{width:u}=e,{height:c}=e,{verticalMode:p}=e,{fontColor:g}=e,{backgroundColor:f}=e,{hintFuriganaFontColor:C}=e,{hintFuriganaShadowColor:v}=e,{fontFamilyGroupOne:k}=e,{fontFamilyGroupTwo:P}=e,{fontSize:G}=e,{lineHeight:D}=e,{hideSpoilerImage:M}=e,{hideFurigana:I}=e,{furiganaStyle:A}=e,{loadingState:O}=e,{bookmarkData:S}=e,{pageManager:E}=e,{bookmarkManager:V}=e,{exploredCharCount:d}=e,{bookCharCount:F}=e,{isBookmarkScreen:w=!1}=e,{avoidPageBreak:L=!0}=e,{pageColumns:j}=e,{firstDimensionMargin:Q}=e,{autoBookmark:fe=!1}=e,{customReadingPointRange:te}=e,{showCustomReadingPoint:Se}=e;const ve=nn();let ce,Pe,z,be=[],q,de,Z,me=!1,ke="",ye=!0,_=0,T=!1,ae,H,Ce;const pe=new Xe,Oe=new Xe,Ie=new Qt(-1),Me=new Xe,Le=new Qt(0),Ue=new Xe,Ve=new Xe,je=Ie.pipe(Ae(b=>{var ne;return((ne=be[b])==null?void 0:ne.innerHTML)||""})),Te=new Xe;yn(()=>{document.body.classList.remove(Kn),Te.next(),Te.complete()}),Vt([pe,Oe]).pipe(Ut(1),Ot(()=>Ve.pipe(Mt(1))),Ze(Te)).subscribe(()=>{if(!z||!q)return;const b=z.getScrollPosByCharCount(_);b<0||q.scrollTo(b,!1)}),Me.pipe(Ze(Te)).subscribe(b=>{var ne;!z||(n(33,Se=!1),Dt((ne=te==null?void 0:te.endContainer)==null?void 0:ne.parentElement,"remove",1),n(28,te=void 0),n(31,d=z.calcExploredCharCount(te)),b&&(_=d,l&&Fo(window)),S.then(xe))}),fe&&Me.pipe(Ht(3e3),Ze(Te)).subscribe(b=>{b&&ve("bookmark")}),je.pipe(Ro(),Ze(Te)).subscribe(()=>{n(19,me=!1)}),je.pipe(Ze(Te)).subscribe(b=>{const ne=(le,qe)=>{if(qe===0){le();return}requestAnimationFrame(()=>ne(le,qe-1))};ne(()=>{n(20,ke=b)},2)}),Ct(()=>Ke(document.body,"wheel",{passive:!0})).pipe(Rr(50),Ze(Te)).subscribe(b=>{if(!o){let ne=(b.deltaX<0?-1:1)*(p?-1:1);b.deltaX||(ne=b.deltaY<0?-1:1),q==null||q.flipPage(ne)}});function st(b){!z||(n(31,d=z.calcExploredCharCount(b)),_=d,Je(b))}function Je(b){!q||!z||q.updateSectionDataByOffset(z.getOffsetToRange(b,i))}function ut(){if(ye){ye=!1;return}!ce||(n(39,z=new sa(ce,be,Le,()=>u,()=>c,()=>wt,p,ce,document)),n(31,d=0),_=0,n(32,F=z.charCount),z.updateCurrentSection(Ie.getValue()),ve("contentChange",ce))}function nt(b){b.updateParagraphPos(),n(31,d=b.calcExploredCharCount(te)),Ve.next(b),S.then(xe),Z&&(Z=!1,S.then(ne=>{!ne||!V||(n(31,d=ne.exploredCharCount||0),V.scrollToBookmark(ne))})),n(19,me=!0)}function xe(b){const ne=b==null?void 0:b.exploredCharCount;if(!z||!ne)return;const le=z.checkBookmarkOnScreen(ne);if(ce&&le.isBookmarkScreen){const qe=Number(getComputedStyle(ce)[p?"marginTop":"marginRight"].replace(/px$/,""));le.bookmarkPos?p?(n(21,ae=qe?`${qe}px`:"0.5rem"),n(22,H=`${le.bookmarkPos.left}px`),n(23,Ce=void 0)):(n(21,ae=`${le.bookmarkPos.top}px`),n(23,Ce=void 0),n(22,H=le.bookmarkPos.left>0?`calc(${le.bookmarkPos.left}px - ${a?"15":"20"}px)`:`calc(${Math.max(a?15:20,qe)}px)`)):$e(qe)}else $e(0);le.isBookmarkScreen&&b.exploredCharCount&&(le.node&&!T&&!le.isFirstNode?Je(Dn(le.node)):le.isFirstNode&&Je(void 0),n(31,d=T?d:b.exploredCharCount),_=d,T=!0),n(0,w=le.isBookmarkScreen)}function $e(b){p?(n(21,ae=b?`${b}px`:"0.5rem"),n(22,H=r?`${u-r}px`:void 0),n(23,Ce=r?void 0:"0.75rem")):(n(21,ae=r?`${r}px`:"0.5rem"),n(22,H=b?`calc(${b}px + 0.75rem)`:"0.75rem"),n(23,Ce=void 0))}function y(b){if(!q||o||b.detail.direction!=="left"&&b.detail.direction!=="right")return;const ne=b.detail.direction==="left",le=p?!ne:ne;q.flipPage(le?1:-1)}function he(b){if(!(!q||o))switch(b.code){case"ArrowLeft":q[p?"nextPage":"prevPage"]();break;case"ArrowRight":q[p?"prevPage":"nextPage"]();break;case"ArrowUp":q.prevPage();break;case"ArrowDown":q.nextPage();break}}Wt.pipe(Ze(Te)).subscribe(b=>{const ne=be.findIndex(le=>le.id===b||le.querySelector(`[id="${b}"]`));ne>-1&&(Ie.next(ne),q==null||q.scrollTo(0,!0))});function ze(b){U[b?"unshift":"push"](()=>{Pe=b,n(18,Pe)})}function Re(b){U[b?"unshift":"push"](()=>{ce=b,n(17,ce)})}return t.$$set=b=>{"htmlContent"in b&&n(34,s=b.htmlContent),"width"in b&&n(1,u=b.width),"height"in b&&n(2,c=b.height),"verticalMode"in b&&n(3,p=b.verticalMode),"fontColor"in b&&n(4,g=b.fontColor),"backgroundColor"in b&&n(5,f=b.backgroundColor),"hintFuriganaFontColor"in b&&n(6,C=b.hintFuriganaFontColor),"hintFuriganaShadowColor"in b&&n(7,v=b.hintFuriganaShadowColor),"fontFamilyGroupOne"in b&&n(8,k=b.fontFamilyGroupOne),"fontFamilyGroupTwo"in b&&n(9,P=b.fontFamilyGroupTwo),"fontSize"in b&&n(10,G=b.fontSize),"lineHeight"in b&&n(11,D=b.lineHeight),"hideSpoilerImage"in b&&n(12,M=b.hideSpoilerImage),"hideFurigana"in b&&n(13,I=b.hideFurigana),"furiganaStyle"in b&&n(14,A=b.furiganaStyle),"loadingState"in b&&n(35,O=b.loadingState),"bookmarkData"in b&&n(36,S=b.bookmarkData),"pageManager"in b&&n(29,E=b.pageManager),"bookmarkManager"in b&&n(30,V=b.bookmarkManager),"exploredCharCount"in b&&n(31,d=b.exploredCharCount),"bookCharCount"in b&&n(32,F=b.bookCharCount),"isBookmarkScreen"in b&&n(0,w=b.isBookmarkScreen),"avoidPageBreak"in b&&n(15,L=b.avoidPageBreak),"pageColumns"in b&&n(37,j=b.pageColumns),"firstDimensionMargin"in b&&n(16,Q=b.firstDimensionMargin),"autoBookmark"in b&&n(38,fe=b.autoBookmark),"customReadingPointRange"in b&&n(28,te=b.customReadingPointRange),"showCustomReadingPoint"in b&&n(33,Se=b.showCustomReadingPoint)},t.$$.update=()=>{if(t.$$.dirty[1]&32&&S.then(b=>{T=!1,xe(b)}),t.$$.dirty[0]&2&&u&&pe.next(u),t.$$.dirty[0]&4&&c&&Oe.next(c),t.$$.dirty[0]&10|t.$$.dirty[1]&64&&n(24,i=p?1:j||Math.ceil(u/1e3)),t.$$.dirty[1]&8&&s&&(Z=!0),t.$$.dirty[1]&8){const b=document.createElement("div");b.innerHTML=s,n(40,be=Array.from(b.children)),Ie.next(0)}if(t.$$.dirty[0]&393230|t.$$.dirty[1]&1536&&Pe&&ce&&be&&(n(41,q=new la(Pe,ce,be,Ie,Le,u,c,wt,p,Me,Ue)),n(29,E=q)),t.$$.dirty[0]&6|t.$$.dirty[1]&272&&z&&u&&c&&!O){const b=z;requestAnimationFrame(()=>{nt(b)})}t.$$.dirty[1]&272&&z&&!O&&Ue.next(Ie.getValue()),t.$$.dirty[1]&3328&&z&&q&&(n(42,de=new aa(z,q,Ve,Ie,b=>_=b)),n(30,V=de)),t.$$.dirty[0]&268435456&&st(te)},document.body.classList.add(Kn),[w,u,c,p,g,f,C,v,k,P,G,D,M,I,A,L,Q,ce,Pe,me,ke,ae,H,Ce,i,ut,y,he,te,E,V,d,F,Se,s,O,S,j,fe,z,be,q,de,ze,Re]}class ha extends ht{constructor(e){super(),dt(this,e,ca,fa,mt,{htmlContent:34,width:1,height:2,verticalMode:3,fontColor:4,backgroundColor:5,hintFuriganaFontColor:6,hintFuriganaShadowColor:7,fontFamilyGroupOne:8,fontFamilyGroupTwo:9,fontSize:10,lineHeight:11,hideSpoilerImage:12,hideFurigana:13,furiganaStyle:14,loadingState:35,bookmarkData:36,pageManager:29,bookmarkManager:30,exploredCharCount:31,bookCharCount:32,isBookmarkScreen:0,avoidPageBreak:15,pageColumns:37,firstDimensionMargin:16,autoBookmark:38,customReadingPointRange:28,showCustomReadingPoint:33},null,[-1,-1,-1])}}function da(t){let e,n,i,o,r,a,l,s,u,c;function p(M){t[59](M)}function g(M){t[60](M)}function f(M){t[61](M)}function C(M){t[62](M)}function v(M){t[63](M)}function k(M){t[64](M)}function P(M){t[65](M)}function G(M){t[66](M)}let D={htmlContent:t[13],width:t[35]??0,height:t[36]??0,verticalMode:t[14],fontColor:t[15],backgroundColor:t[16],hintFuriganaFontColor:t[17],hintFuriganaShadowColor:t[18],fontFamilyGroupOne:t[19],fontFamilyGroupTwo:t[20],fontSize:t[21],lineHeight:t[22],hideSpoilerImage:t[23],hideFurigana:t[24],furiganaStyle:t[25],loadingState:t[37]??!0,avoidPageBreak:t[29],pageColumns:t[30],autoBookmark:t[31],firstDimensionMargin:t[27]};return t[0]!==void 0&&(D.exploredCharCount=t[0]),t[1]!==void 0&&(D.bookCharCount=t[1]),t[6]!==void 0&&(D.isBookmarkScreen=t[6]),t[2]!==void 0&&(D.bookmarkData=t[2]),t[4]!==void 0&&(D.bookmarkManager=t[4]),t[5]!==void 0&&(D.pageManager=t[5]),t[11]!==void 0&&(D.customReadingPointRange=t[11]),t[12]!==void 0&&(D.showCustomReadingPoint=t[12]),e=new ha({props:D}),U.push(()=>oe(e,"exploredCharCount",p,t[0])),U.push(()=>oe(e,"bookCharCount",g,t[1])),U.push(()=>oe(e,"isBookmarkScreen",f,t[6])),U.push(()=>oe(e,"bookmarkData",C,t[2])),U.push(()=>oe(e,"bookmarkManager",v,t[4])),U.push(()=>oe(e,"pageManager",k,t[5])),U.push(()=>oe(e,"customReadingPointRange",P,t[11])),U.push(()=>oe(e,"showCustomReadingPoint",G,t[12])),e.$on("contentChange",t[67]),e.$on("bookmark",t[68]),{c(){Be(e.$$.fragment)},l(M){Ee(e.$$.fragment,M)},m(M,I){Fe(e,M,I),c=!0},p(M,I){const A={};I[0]&8192&&(A.htmlContent=M[13]),I[1]&16&&(A.width=M[35]??0),I[1]&32&&(A.height=M[36]??0),I[0]&16384&&(A.verticalMode=M[14]),I[0]&32768&&(A.fontColor=M[15]),I[0]&65536&&(A.backgroundColor=M[16]),I[0]&131072&&(A.hintFuriganaFontColor=M[17]),I[0]&262144&&(A.hintFuriganaShadowColor=M[18]),I[0]&524288&&(A.fontFamilyGroupOne=M[19]),I[0]&1048576&&(A.fontFamilyGroupTwo=M[20]),I[0]&2097152&&(A.fontSize=M[21]),I[0]&4194304&&(A.lineHeight=M[22]),I[0]&8388608&&(A.hideSpoilerImage=M[23]),I[0]&16777216&&(A.hideFurigana=M[24]),I[0]&33554432&&(A.furiganaStyle=M[25]),I[1]&64&&(A.loadingState=M[37]??!0),I[0]&536870912&&(A.avoidPageBreak=M[29]),I[0]&1073741824&&(A.pageColumns=M[30]),I[1]&1&&(A.autoBookmark=M[31]),I[0]&134217728&&(A.firstDimensionMargin=M[27]),!n&&I[0]&1&&(n=!0,A.exploredCharCount=M[0],ie(()=>n=!1)),!i&&I[0]&2&&(i=!0,A.bookCharCount=M[1],ie(()=>i=!1)),!o&&I[0]&64&&(o=!0,A.isBookmarkScreen=M[6],ie(()=>o=!1)),!r&&I[0]&4&&(r=!0,A.bookmarkData=M[2],ie(()=>r=!1)),!a&&I[0]&16&&(a=!0,A.bookmarkManager=M[4],ie(()=>a=!1)),!l&&I[0]&32&&(l=!0,A.pageManager=M[5],ie(()=>l=!1)),!s&&I[0]&2048&&(s=!0,A.customReadingPointRange=M[11],ie(()=>s=!1)),!u&&I[0]&4096&&(u=!0,A.showCustomReadingPoint=M[12],ie(()=>u=!1)),e.$set(A)},i(M){c||(Y(e.$$.fragment,M),c=!0)},o(M){J(e.$$.fragment,M),c=!1},d(M){De(e,M)}}}function ma(t){let e,n,i,o,r,a,l,s,u,c,p,g;function f(S){t[47](S)}function C(S){t[48](S)}function v(S){t[49](S)}function k(S){t[50](S)}function P(S){t[51](S)}function G(S){t[52](S)}function D(S){t[53](S)}function M(S){t[54](S)}function I(S){t[55](S)}function A(S){t[56](S)}let O={htmlContent:t[13],width:t[35]??0,height:t[36]??0,verticalMode:t[14],fontColor:t[15],backgroundColor:t[16],hintFuriganaFontColor:t[17],hintFuriganaShadowColor:t[18],fontFamilyGroupOne:t[19],fontFamilyGroupTwo:t[20],fontSize:t[21],lineHeight:t[22],hideSpoilerImage:t[23],hideFurigana:t[24],furiganaStyle:t[25],secondDimensionMaxValue:t[26],firstDimensionMargin:t[27],autoPositionOnResize:t[28],autoBookmark:t[31],multiplier:t[33],loadingState:t[37]??!0};return t[0]!==void 0&&(O.exploredCharCount=t[0]),t[1]!==void 0&&(O.bookCharCount=t[1]),t[2]!==void 0&&(O.bookmarkData=t[2]),t[3]!==void 0&&(O.autoScroller=t[3]),t[4]!==void 0&&(O.bookmarkManager=t[4]),t[5]!==void 0&&(O.pageManager=t[5]),t[7]!==void 0&&(O.customReadingPoint=t[7]),t[8]!==void 0&&(O.customReadingPointTop=t[8]),t[9]!==void 0&&(O.customReadingPointLeft=t[9]),t[10]!==void 0&&(O.customReadingPointScrollOffset=t[10]),e=new Kr({props:O}),U.push(()=>oe(e,"exploredCharCount",f,t[0])),U.push(()=>oe(e,"bookCharCount",C,t[1])),U.push(()=>oe(e,"bookmarkData",v,t[2])),U.push(()=>oe(e,"autoScroller",k,t[3])),U.push(()=>oe(e,"bookmarkManager",P,t[4])),U.push(()=>oe(e,"pageManager",G,t[5])),U.push(()=>oe(e,"customReadingPoint",D,t[7])),U.push(()=>oe(e,"customReadingPointTop",M,t[8])),U.push(()=>oe(e,"customReadingPointLeft",I,t[9])),U.push(()=>oe(e,"customReadingPointScrollOffset",A,t[10])),e.$on("contentChange",t[57]),e.$on("bookmark",t[58]),{c(){Be(e.$$.fragment)},l(S){Ee(e.$$.fragment,S)},m(S,E){Fe(e,S,E),g=!0},p(S,E){const V={};E[0]&8192&&(V.htmlContent=S[13]),E[1]&16&&(V.width=S[35]??0),E[1]&32&&(V.height=S[36]??0),E[0]&16384&&(V.verticalMode=S[14]),E[0]&32768&&(V.fontColor=S[15]),E[0]&65536&&(V.backgroundColor=S[16]),E[0]&131072&&(V.hintFuriganaFontColor=S[17]),E[0]&262144&&(V.hintFuriganaShadowColor=S[18]),E[0]&524288&&(V.fontFamilyGroupOne=S[19]),E[0]&1048576&&(V.fontFamilyGroupTwo=S[20]),E[0]&2097152&&(V.fontSize=S[21]),E[0]&4194304&&(V.lineHeight=S[22]),E[0]&8388608&&(V.hideSpoilerImage=S[23]),E[0]&16777216&&(V.hideFurigana=S[24]),E[0]&33554432&&(V.furiganaStyle=S[25]),E[0]&67108864&&(V.secondDimensionMaxValue=S[26]),E[0]&134217728&&(V.firstDimensionMargin=S[27]),E[0]&268435456&&(V.autoPositionOnResize=S[28]),E[1]&1&&(V.autoBookmark=S[31]),E[1]&4&&(V.multiplier=S[33]),E[1]&64&&(V.loadingState=S[37]??!0),!n&&E[0]&1&&(n=!0,V.exploredCharCount=S[0],ie(()=>n=!1)),!i&&E[0]&2&&(i=!0,V.bookCharCount=S[1],ie(()=>i=!1)),!o&&E[0]&4&&(o=!0,V.bookmarkData=S[2],ie(()=>o=!1)),!r&&E[0]&8&&(r=!0,V.autoScroller=S[3],ie(()=>r=!1)),!a&&E[0]&16&&(a=!0,V.bookmarkManager=S[4],ie(()=>a=!1)),!l&&E[0]&32&&(l=!0,V.pageManager=S[5],ie(()=>l=!1)),!s&&E[0]&128&&(s=!0,V.customReadingPoint=S[7],ie(()=>s=!1)),!u&&E[0]&256&&(u=!0,V.customReadingPointTop=S[8],ie(()=>u=!1)),!c&&E[0]&512&&(c=!0,V.customReadingPointLeft=S[9],ie(()=>c=!1)),!p&&E[0]&1024&&(p=!0,V.customReadingPointScrollOffset=S[10],ie(()=>p=!1)),e.$set(V)},i(S){g||(Y(e.$$.fragment,S),g=!0)},o(S){J(e.$$.fragment,S),g=!1},d(S){De(e,S)}}}function ga(t){let e,n,i,o,r=(t[38]??"")+"",a,l;const s=[ma,da],u=[];function c(p,g){return p[32]===Tt.Continuous?0:1}return n=c(t),i=u[n]=s[n](t),{c(){e=x("div"),i.c(),o=se(),a=_e(r),this.h()},l(p){e=$(p,"DIV",{class:!0});var g=ee(e);i.l(g),g.forEach(B),o=ue(p),a=we(p,r),this.h()},h(){K(e,"class",Ur+" py-8")},m(p,g){N(p,e,g),u[n].m(e,null),t[69](e),N(p,o,g),N(p,a,g),l=!0},p(p,g){let f=n;n=c(p),n===f?u[n].p(p,g):(it(),J(u[f],1,1,()=>{u[f]=null}),rt(),i=u[n],i?i.p(p,g):(i=u[n]=s[n](p),i.c()),Y(i,1),i.m(e,null)),(!l||g[1]&128)&&r!==(r=(p[38]??"")+"")&&Ge(a,r)},i(p){l||(Y(i),l=!0)},o(p){J(i),l=!1},d(p){p&&B(e),u[n].d(),t[69](null),p&&B(o),p&&B(a)}}}function Xt(t){return Number(t.replace(/px$/,""))}function ka(t,e,n){let i,o,r,a,l,s,{htmlContent:u}=e,{width:c}=e,{height:p}=e,{verticalMode:g}=e,{fontColor:f}=e,{backgroundColor:C}=e,{hintFuriganaFontColor:v}=e,{hintFuriganaShadowColor:k}=e,{fontFamilyGroupOne:P}=e,{fontFamilyGroupTwo:G}=e,{fontSize:D}=e,{lineHeight:M}=e,{hideSpoilerImage:I}=e,{hideFurigana:A}=e,{furiganaStyle:O}=e,{secondDimensionMaxValue:S}=e,{firstDimensionMargin:E}=e,{autoPositionOnResize:V}=e,{avoidPageBreak:d}=e,{pageColumns:F}=e,{autoBookmark:w}=e,{viewMode:L}=e,{exploredCharCount:j}=e,{bookCharCount:Q}=e,{multiplier:fe}=e,{bookmarkData:te}=e,{autoScroller:Se}=e,{bookmarkManager:ve}=e,{pageManager:ce}=e,{isBookmarkScreen:Pe}=e,{customReadingPoint:z}=e,{customReadingPointTop:be}=e,{customReadingPointLeft:q}=e,{customReadingPointScrollOffset:de}=e,{customReadingPointRange:Z}=e,{showCustomReadingPoint:me}=e;const ke=new Xe,ye=new Xe,_=Ui(null);X(t,_,m=>n(34,o=m));const T=Vt([_.pipe(on(m=>!!m)),Vt([ke,ye]).pipe(_n(0))]).pipe(Ht(0,ln),Ae(([m])=>getComputedStyle(m)),wn({refCount:!0,bufferSize:1})),ae=new bi(1),H=T.pipe(Ae(m=>Ie(c-Xt(m.paddingLeft)-Xt(m.paddingRight))));X(t,H,m=>n(35,r=m));const Ce=T.pipe(Ae(m=>Me(p-Xt(m.paddingTop)-Xt(m.paddingBottom)-i)));X(t,Ce,m=>n(36,a=m));const pe=Ct(()=>En(document)).pipe(Yt(m=>{const dn=Zr(m,O);return ae.pipe(Yt(mn=>dn(mn)))}),pt());X(t,pe,m=>n(38,s=m));const Oe=ae.pipe(Yt(m=>Jr(m)),Sn());X(t,Oe,m=>n(37,l=m));function Ie(m){return Tt.Paginated===L&&!g&&S?Math.min(S,m):m}function Me(m){return Tt.Paginated===L&&g&&S?Math.min(S,m):m}function Le(m){j=m,n(0,j)}function Ue(m){Q=m,n(1,Q)}function Ve(m){te=m,n(2,te)}function je(m){Se=m,n(3,Se)}function Te(m){ve=m,n(4,ve)}function st(m){ce=m,n(5,ce)}function Je(m){z=m,n(7,z)}function ut(m){be=m,n(8,be)}function nt(m){q=m,n(9,q)}function xe(m){de=m,n(10,de)}const $e=m=>ae.next(m.detail);function y(m){In.call(this,t,m)}function he(m){j=m,n(0,j)}function ze(m){Q=m,n(1,Q)}function Re(m){Pe=m,n(6,Pe)}function b(m){te=m,n(2,te)}function ne(m){ve=m,n(4,ve)}function le(m){ce=m,n(5,ce)}function qe(m){Z=m,n(11,Z)}function un(m){me=m,n(12,me)}const fn=m=>ae.next(m.detail);function cn(m){In.call(this,t,m)}function hn(m){U[m?"unshift":"push"](()=>{o=m,_.set(o)})}return t.$$set=m=>{"htmlContent"in m&&n(13,u=m.htmlContent),"width"in m&&n(45,c=m.width),"height"in m&&n(46,p=m.height),"verticalMode"in m&&n(14,g=m.verticalMode),"fontColor"in m&&n(15,f=m.fontColor),"backgroundColor"in m&&n(16,C=m.backgroundColor),"hintFuriganaFontColor"in m&&n(17,v=m.hintFuriganaFontColor),"hintFuriganaShadowColor"in m&&n(18,k=m.hintFuriganaShadowColor),"fontFamilyGroupOne"in m&&n(19,P=m.fontFamilyGroupOne),"fontFamilyGroupTwo"in m&&n(20,G=m.fontFamilyGroupTwo),"fontSize"in m&&n(21,D=m.fontSize),"lineHeight"in m&&n(22,M=m.lineHeight),"hideSpoilerImage"in m&&n(23,I=m.hideSpoilerImage),"hideFurigana"in m&&n(24,A=m.hideFurigana),"furiganaStyle"in m&&n(25,O=m.furiganaStyle),"secondDimensionMaxValue"in m&&n(26,S=m.secondDimensionMaxValue),"firstDimensionMargin"in m&&n(27,E=m.firstDimensionMargin),"autoPositionOnResize"in m&&n(28,V=m.autoPositionOnResize),"avoidPageBreak"in m&&n(29,d=m.avoidPageBreak),"pageColumns"in m&&n(30,F=m.pageColumns),"autoBookmark"in m&&n(31,w=m.autoBookmark),"viewMode"in m&&n(32,L=m.viewMode),"exploredCharCount"in m&&n(0,j=m.exploredCharCount),"bookCharCount"in m&&n(1,Q=m.bookCharCount),"multiplier"in m&&n(33,fe=m.multiplier),"bookmarkData"in m&&n(2,te=m.bookmarkData),"autoScroller"in m&&n(3,Se=m.autoScroller),"bookmarkManager"in m&&n(4,ve=m.bookmarkManager),"pageManager"in m&&n(5,ce=m.pageManager),"isBookmarkScreen"in m&&n(6,Pe=m.isBookmarkScreen),"customReadingPoint"in m&&n(7,z=m.customReadingPoint),"customReadingPointTop"in m&&n(8,be=m.customReadingPointTop),"customReadingPointLeft"in m&&n(9,q=m.customReadingPointLeft),"customReadingPointScrollOffset"in m&&n(10,de=m.customReadingPointScrollOffset),"customReadingPointRange"in m&&n(11,Z=m.customReadingPointRange),"showCustomReadingPoint"in m&&n(12,me=m.showCustomReadingPoint)},t.$$.update=()=>{t.$$.dirty[0]&134234112|t.$$.dirty[1]&2&&(i=E&&Tt.Paginated===L&&!g?E*2:0),t.$$.dirty[1]&16384&&ke.next(c),t.$$.dirty[1]&32768&&ye.next(p)},[j,Q,te,Se,ve,ce,Pe,z,be,q,de,Z,me,u,g,f,C,v,k,P,G,D,M,I,A,O,S,E,V,d,F,w,L,fe,o,r,a,l,s,_,ae,H,Ce,pe,Oe,c,p,Le,Ue,Ve,je,Te,st,Je,ut,nt,xe,$e,y,he,ze,Re,b,ne,le,qe,un,fn,cn,hn]}class pa extends ht{constructor(e){super(),dt(this,e,ka,ga,mt,{htmlContent:13,width:45,height:46,verticalMode:14,fontColor:15,backgroundColor:16,hintFuriganaFontColor:17,hintFuriganaShadowColor:18,fontFamilyGroupOne:19,fontFamilyGroupTwo:20,fontSize:21,lineHeight:22,hideSpoilerImage:23,hideFurigana:24,furiganaStyle:25,secondDimensionMaxValue:26,firstDimensionMargin:27,autoPositionOnResize:28,avoidPageBreak:29,pageColumns:30,autoBookmark:31,viewMode:32,exploredCharCount:0,bookCharCount:1,multiplier:33,bookmarkData:2,autoScroller:3,bookmarkManager:4,pageManager:5,isBookmarkScreen:6,customReadingPoint:7,customReadingPointTop:8,customReadingPointLeft:9,customReadingPointScrollOffset:10,customReadingPointRange:11,showCustomReadingPoint:12},null,[-1,-1,-1])}}function ba(t,e){const n=document.createTextNode(e);if(t.firstChild){t.replaceChild(n,t.firstChild);return}t.appendChild(n)}function Ca(t,e,n){let{styleSheet:i}=e,o;return uo(()=>{n(1,o=document.createElement("style")),document.head.appendChild(o)}),yn(()=>{o&&document.head.removeChild(o)}),t.$$set=r=>{"styleSheet"in r&&n(0,i=r.styleSheet)},t.$$.update=()=>{t.$$.dirty&3&&o&&ba(o,i)},[i,o]}class _a extends ht{constructor(e){super(),dt(this,e,Ca,null,mt,{styleSheet:0})}}function Un(t){let e,n,i,o,r;return n=new at({props:{icon:$i}}),{c(){e=x("div"),Be(n.$$.fragment),this.h()},l(a){e=$(a,"DIV",{role:!0,class:!0});var l=ee(e);Ee(n.$$.fragment,l),l.forEach(B),this.h()},h(){K(e,"role","button"),K(e,"class",bo)},m(a,l){N(a,e,l),Fe(n,e,null),i=!0,o||(r=[We(e,"click",t[7]),We(e,"keyup",Po)],o=!0)},p:At,i(a){i||(Y(n.$$.fragment,a),i=!0)},o(a){J(n.$$.fragment,a),i=!1},d(a){a&&B(e),De(n),o=!1,yt(r)}}}function Jn(t){let e,n,i;return{c(){e=x("div"),n=_e(t[1]),i=_e("x"),this.h()},l(o){e=$(o,"DIV",{class:!0});var r=ee(e);n=we(r,t[1]),i=we(r,"x"),r.forEach(B),this.h()},h(){K(e,"class","flex items-center px-4 text-xl xl:px-3 xl:text-lg")},m(o,r){N(o,e,r),re(e,n),re(e,i)},p(o,r){r&2&&Ge(n,o[1])},d(o){o&&B(e)}}}function wa(t){let e,n,i,o,r,a,l,s,u,c,p,g,f=t[0]&&Un(t);r=new at({props:{icon:t[2]?zt:zn}});let C=!t[3]&&Jn(t);return u=new xi({props:{items:[Zt.SETTINGS,Zt.MANAGE]}}),u.$on("action",t[9]),{c(){e=x("div"),n=x("div"),f&&f.c(),i=se(),o=x("div"),Be(r.$$.fragment),a=se(),C&&C.c(),l=se(),s=x("div"),Be(u.$$.fragment),this.h()},l(v){e=$(v,"DIV",{class:!0});var k=ee(e);n=$(k,"DIV",{class:!0});var P=ee(n);f&&f.l(P),i=ue(P),o=$(P,"DIV",{role:!0,class:!0});var G=ee(o);Ee(r.$$.fragment,G),G.forEach(B),a=ue(P),C&&C.l(P),P.forEach(B),l=ue(k),s=$(k,"DIV",{class:!0});var D=ee(s);Ee(u.$$.fragment,D),D.forEach(B),k.forEach(B),this.h()},h(){K(o,"role","button"),K(o,"class",bo),K(n,"class","flex transform-gpu "+Ci),K(s,"class","flex transform-gpu "+_i),K(e,"class","flex justify-between bg-gray-700 px-4 md:px-8 "+wi)},m(v,k){N(v,e,k),re(e,n),f&&f.m(n,null),re(n,i),re(n,o),Fe(r,o,null),re(n,a),C&&C.m(n,null),re(e,l),re(e,s),Fe(u,s,null),c=!0,p||(g=[We(o,"click",t[8]),We(o,"keyup",Po)],p=!0)},p(v,[k]){v[0]?f?(f.p(v,k),k&1&&Y(f,1)):(f=Un(v),f.c(),Y(f,1),f.m(n,i)):f&&(it(),J(f,1,1,()=>{f=null}),rt());const P={};k&4&&(P.icon=v[2]?zt:zn),r.$set(P),v[3]?C&&(C.d(1),C=null):C?C.p(v,k):(C=Jn(v),C.c(),C.m(n,null))},i(v){c||(Y(f),Y(r.$$.fragment,v),Y(u.$$.fragment,v),c=!0)},o(v){J(f),J(r.$$.fragment,v),J(u.$$.fragment,v),c=!1},d(v){v&&B(e),f&&f.d(),De(r),C&&C.d(),De(u),p=!1,yt(g)}}}function Sa(t,e,n){let i;X(t,Bn,f=>n(3,i=f));let{hasChapterData:o}=e,{autoScrollMultiplier:r}=e,{hasCustomReadingPoint:a}=e,{showFullscreenButton:l}=e,{isBookmarkScreen:s}=e;const u=nn(),c=()=>u("tocClick"),p=()=>u("bookmarkClick"),g=({detail:f})=>{f===Zt.SETTINGS.label?u("settingsClick"):f===Zt.MANAGE.label&&u("bookManagerClick")};return t.$$set=f=>{"hasChapterData"in f&&n(0,o=f.hasChapterData),"autoScrollMultiplier"in f&&n(1,r=f.autoScrollMultiplier),"hasCustomReadingPoint"in f&&n(5,a=f.hasCustomReadingPoint),"showFullscreenButton"in f&&n(6,l=f.showFullscreenButton),"isBookmarkScreen"in f&&n(2,s=f.isBookmarkScreen)},[o,r,s,i,u,a,l,c,p,g]}class Pa extends ht{constructor(e){super(),dt(this,e,Sa,wa,mt,{hasChapterData:0,autoScrollMultiplier:1,hasCustomReadingPoint:5,showFullscreenButton:6,isBookmarkScreen:2})}}function Qn(t,e,n){const i=t.slice();return i[16]=e[n],i}function Zn(t,e){let n,i,o=e[16].label+"",r,a,l,s,u=e[16].startCharacter+"",c,p,g,f;function C(){return e[13](e[16])}return{key:t,first:null,c(){n=x("div"),i=x("div"),r=_e(o),l=se(),s=x("div"),c=_e(u),p=se(),this.h()},l(v){n=$(v,"DIV",{class:!0});var k=ee(n);i=$(k,"DIV",{id:!0,class:!0});var P=ee(i);r=we(P,o),P.forEach(B),l=ue(k),s=$(k,"DIV",{});var G=ee(s);c=we(G,u),G.forEach(B),p=ue(k),k.forEach(B),this.h()},h(){K(i,"id",a=`for${e[16].reference}`),K(i,"class","mr-4 cursor-pointer"),W(i,"opacity-30",e[16].progress===100&&e[16]!==e[2]),W(i,"hover:opacity-100",e[16].progress===100&&e[16]!==e[2]),W(i,"hover:opacity-60",e[16].progress<100||e[16]===e[2]),W(s,"opacity-30",e[16].progress===100&&e[16]!==e[2]),K(n,"class","my-6 flex justify-between"),this.first=n},m(v,k){N(v,n,k),re(n,i),re(i,r),re(n,l),re(n,s),re(s,c),re(n,p),g||(f=We(i,"click",C),g=!0)},p(v,k){e=v,k&2&&o!==(o=e[16].label+"")&&Ge(r,o),k&2&&a!==(a=`for${e[16].reference}`)&&K(i,"id",a),k&6&&W(i,"opacity-30",e[16].progress===100&&e[16]!==e[2]),k&6&&W(i,"hover:opacity-100",e[16].progress===100&&e[16]!==e[2]),k&6&&W(i,"hover:opacity-60",e[16].progress<100||e[16]===e[2]),k&2&&u!==(u=e[16].startCharacter+"")&&Ge(c,u),k&6&&W(s,"opacity-30",e[16].progress===100&&e[16]!==e[2])},d(v){v&&B(n),g=!1,f()}}}function va(t){let e,n,i,o,r,a,l,s,u,c,p,g,f=[],C=new Map,v,k,P,G,D,M,I,A,O,S;c=new at({props:{icon:er}});let E=t[1];const V=d=>d[16].reference;for(let d=0;d<E.length;d+=1){let F=Qn(t,E,d),w=V(F);C.set(w,f[d]=Zn(w,F))}return G=new at({props:{icon:tr}}),I=new at({props:{icon:nr}}),{c(){e=x("div"),n=x("div"),i=_e("Chapter Progress: "),o=_e(t[3]),r=_e(" ("),a=_e(t[4]),l=_e("%)"),s=se(),u=x("div"),Be(c.$$.fragment),p=se(),g=x("div");for(let d=0;d<f.length;d+=1)f[d].c();v=se(),k=x("div"),P=x("div"),Be(G.$$.fragment),D=se(),M=x("div"),Be(I.$$.fragment),this.h()},l(d){e=$(d,"DIV",{class:!0});var F=ee(e);n=$(F,"DIV",{});var w=ee(n);i=we(w,"Chapter Progress: "),o=we(w,t[3]),r=we(w," ("),a=we(w,t[4]),l=we(w,"%)"),w.forEach(B),s=ue(F),u=$(F,"DIV",{class:!0});var L=ee(u);Ee(c.$$.fragment,L),L.forEach(B),F.forEach(B),p=ue(d),g=$(d,"DIV",{class:!0});var j=ee(g);for(let Se=0;Se<f.length;Se+=1)f[Se].l(j);j.forEach(B),v=ue(d),k=$(d,"DIV",{class:!0});var Q=ee(k);P=$(Q,"DIV",{class:!0});var fe=ee(P);Ee(G.$$.fragment,fe),fe.forEach(B),D=ue(Q),M=$(Q,"DIV",{class:!0});var te=ee(M);Ee(I.$$.fragment,te),te.forEach(B),Q.forEach(B),this.h()},h(){K(u,"class","flex cursor-pointer items-end md:items-center"),K(e,"class","flex justify-between p-4"),K(g,"class","flex-1 overflow-auto p-4"),K(P,"class","cursor-pointer"),W(P,"opacity-30",!t[6]),K(M,"class","cursor-pointer"),W(M,"opacity-30",!t[5]),K(k,"class","flex justify-between px-4 py-6")},m(d,F){N(d,e,F),re(e,n),re(n,i),re(n,o),re(n,r),re(n,a),re(n,l),re(e,s),re(e,u),Fe(c,u,null),N(d,p,F),N(d,g,F);for(let w=0;w<f.length;w+=1)f[w].m(g,null);N(d,v,F),N(d,k,F),re(k,P),Fe(G,P,null),re(k,D),re(k,M),Fe(I,M,null),A=!0,O||(S=[We(u,"click",t[9]),We(P,"click",t[14]),We(M,"click",t[15])],O=!0)},p(d,[F]){(!A||F&8)&&Ge(o,d[3]),(!A||F&16)&&Ge(a,d[4]),F&262&&(E=d[1],f=li(f,F,V,1,d,E,C,g,si,Zn,null,Qn)),(!A||F&64)&&W(P,"opacity-30",!d[6]),(!A||F&32)&&W(M,"opacity-30",!d[5])},i(d){A||(Y(c.$$.fragment,d),Y(G.$$.fragment,d),Y(I.$$.fragment,d),A=!0)},o(d){J(c.$$.fragment,d),J(G.$$.fragment,d),J(I.$$.fragment,d),A=!1},d(d){d&&B(e),De(c),d&&B(p),d&&B(g);for(let F=0;F<f.length;F+=1)f[F].d();d&&B(v),d&&B(k),De(G),De(I),O=!1,yt(S)}}}function ya(t,e){const[n,i]=e.reduce((o,r,a)=>(o[0]+=t[a]*r,o[1]+=r,o),[0,0]);return n/i}function xn(t){!t||(t.scrollIntoViewIfNeeded?t.scrollIntoViewIfNeeded():t.scrollIntoView())}function Ra(t,e,n){let i,o,{sectionData:r=[]}=e,{exploredCharCount:a=0}=e,{verticalMode:l}=e,s=[],u,c=-1,p="0/0",g="0.00";uo(()=>{Ln.dialogs$.next([{component:"<div/>"}]),u&&xn(document.getElementById(`for${u.reference}`))});function f(D,M){if(D){const I=s[c+M];C(I.reference,!1)}}function C(D,M=!1){Wt.next(D),M&&v()}function v(){St.next(!1),Ln.dialogs$.next([])}const k=D=>C(D.reference,!0),P=()=>f(i,l?1:-1),G=()=>f(o,l?-1:1);return t.$$set=D=>{"sectionData"in D&&n(10,r=D.sectionData),"exploredCharCount"in D&&n(11,a=D.exploredCharCount),"verticalMode"in D&&n(0,l=D.verticalMode)},t.$$.update=()=>{if(t.$$.dirty&5120&&r){const[D,M,I]=Bo(r),A=r.filter(O=>O.reference===I||O.parentChapter===I);n(4,g=ya(A.map(O=>O.progress),A.map(O=>O.charactersWeight)).toFixed(2)),n(1,s=D),n(12,c=M),n(2,u=D[c])}if(t.$$.dirty&4099&&n(6,i=l?c<s.length-1:!!c),t.$$.dirty&4099&&n(5,o=l?!!c:c<s.length-1),t.$$.dirty&2052&&u){xn(document.getElementById(`for${u.reference}`));const D=u.characters;n(3,p=`${Math.min(Math.max(a-u.startCharacter,0),D)} / ${D}`)}},[l,s,u,p,g,o,i,f,C,v,r,a,c,k,P,G]}class Ma extends ht{constructor(e){super(),dt(this,e,Ra,va,mt,{sectionData:10,exploredCharCount:11,verticalMode:0})}}class Ba{constructor(e){Ne(this,"fallbackSpec");this.fallbackSpec=$n(e)}get fullscreenEnabled(){return this.fallbackSpec("fullscreenEnabled","webkitFullscreenEnabled")??!1}get fullscreenElement(){return this.fallbackSpec("fullscreenElement","webkitFullscreenElement")??null}async requestFullscreen(e,n){const i=$n(e)("requestFullscreen","webkitRequestFullscreen");!i||await i(n)}async exitFullscreen(){const e=this.fallbackSpec("exitFullscreen","webkitExitFullscreen");!e||await e()}}function $n(t){return(e,n)=>eo(t,e)??eo(t,n)}function eo(t,e){const n=t[e];return typeof n=="function"?n.bind(t):n}const Kt=new Ba(document);function Ea(t,e){return Fa(t).pipe(Ae(n=>{const i=e.createElement("div");return i.innerHTML=n,Da(i),Ta(i),Ia(i,e),Aa(i),i.innerHTML}))}function Fa(t){return new lt(e=>{const{blobs:n}=t;let{elementHtml:i}=t;const o=[];return Object.entries(n).forEach(([r,a])=>{const l=URL.createObjectURL(a);o.push(l),i=i.replaceAll(Qi(r),l).replaceAll(`ttu:${r}`,l)}),e.next(i),()=>{o.forEach(r=>URL.revokeObjectURL(r))}})}function Da(t){Array.from(t.getElementsByTagName("img")).map(e=>({parentEl:e.parentElement,isGaiji:wo(e)})).forEach(({parentEl:e,isGaiji:n})=>{e==null||e.classList.add("ttu-img-container"),n||e==null||e.classList.add("ttu-illustration-container")})}function Ta(t){Array.from(t.getElementsByTagName("svg")).forEach(e=>{e.removeAttribute("width"),e.removeAttribute("height")})}function Ia(t,e){const n=()=>{let o=[...t.children];const r=o.findIndex(a=>a.getElementsByTagName("a").length>1)+1;return r>0&&r<o.length&&(o=o.slice(r)),o},i=(o,r)=>{const a=e.createElement("span");a.toggleAttribute("data-ttu-spoiler-img"),(o.parentElement||r).insertBefore(a,o),a.appendChild(o)};n().forEach(o=>{Array.from(o.getElementsByTagName("img")).filter(r=>!wo(r)).forEach(r=>i(r,o)),Array.from(o.getElementsByTagName("svg")).filter(r=>r.getElementsByTagName("image").length).forEach(r=>i(r,o))})}function Aa(t){t.querySelectorAll(".placeholder-br").forEach(e=>{e.parentElement.removeChild(e)})}var Oa=Oo;function Oo(t,e,n){t instanceof RegExp&&(t=to(t,n)),e instanceof RegExp&&(e=to(e,n));const i=Lo(t,e,n);return i&&{start:i[0],end:i[1],pre:n.slice(0,i[0]),body:n.slice(i[0]+t.length,i[1]),post:n.slice(i[1]+e.length)}}function to(t,e){const n=e.match(t);return n?n[0]:null}Oo.range=Lo;function Lo(t,e,n){let i,o,r,a,l,s=n.indexOf(t),u=n.indexOf(e,s+1),c=s;if(s>=0&&u>0){if(t===e)return[s,u];for(i=[],r=n.length;c>=0&&!l;)c===s?(i.push(c),s=n.indexOf(t,c+1)):i.length===1?l=[i.pop(),u]:(o=i.pop(),o<r&&(r=o,a=u),u=n.indexOf(e,c+1)),c=s<u&&s>=0?s:u;i.length&&(l=[r,a])}return l}function La(t,e={}){const i=Object.assign({},{preserveStatic:!0,removeComments:!1},e),o=[];function r(w){throw new Error(`CSS parse error: ${w}`)}function a(w){const L=w.exec(t);if(L)return t=t.slice(L[0].length),L}function l(){return a(/^{\s*/)}function s(){return a(/^}/)}function u(){a(/^\s*/)}function c(){if(u(),t[0]!=="/"||t[1]!=="*")return;let w=2;for(;t[w]&&(t[w]!=="*"||t[w+1]!=="/");)w++;if(!t[w])return r("end of comment is missing");const L=t.slice(2,w);return t=t.slice(w+2),{type:"comment",comment:L}}function p(){const w=[];let L;for(;L=c();)w.push(L);return i.removeComments?[]:w}function g(){for(u();t[0]==="}";)r("extra closing bracket");const w=a(/^(("(?:\\"|[^"])*"|'(?:\\'|[^'])*'|[^{])+)/);if(w)return w[0].trim().replace(/\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*\/+/g,"").replace(/"(?:\\"|[^"])*"|'(?:\\'|[^'])*'/g,function(L){return L.replace(/,/g,"‌")}).split(/\s*(?![^(]*\)),\s*/).map(function(L){return L.replace(/\u200C/g,",")})}function f(){if(t[0]==="@")return V();a(/^([;\s]*)+/);const w=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g;let L=a(/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/);if(!L)return;if(L=L[0].trim(),!a(/^:\s*/))return r("property missing ':'");const j=a(/^((?:\/\*.*?\*\/|'(?:\\'|.)*?'|"(?:\\"|.)*?"|\((\s*'(?:\\'|.)*?'|"(?:\\"|.)*?"|[^)]*?)\s*\)|[^};])+)/),Q={type:"declaration",property:L.replace(w,""),value:j?j[0].replace(w,"").trim():""};return a(/^[;\s]*/),Q}function C(){if(!l())return r("missing '{'");let w,L=p();for(;w=f();)L.push(w),L=L.concat(p());return s()?L:r("missing '}'")}function v(){u();const w=[];let L;for(;L=a(/^((\d+\.\d+|\.\d+|\d+)%?|[a-z]+)\s*/);)w.push(L[1]),a(/^,\s*/);if(w.length)return{type:"keyframe",values:w,declarations:C()}}function k(){let w=a(/^@([-\w]+)?keyframes\s*/);if(!w)return;const L=w[1];if(w=a(/^([-\w]+)\s*/),!w)return r("@keyframes missing name");const j=w[1];if(!l())return r("@keyframes missing '{'");let Q,fe=p();for(;Q=v();)fe.push(Q),fe=fe.concat(p());return s()?{type:"keyframes",name:j,vendor:L,keyframes:fe}:r("@keyframes missing '}'")}function P(){if(a(/^@page */))return{type:"page",selectors:g()||[],declarations:C()}}function G(){const w=a(/@(top|bottom|left|right)-(left|center|right|top|middle|bottom)-?(corner)?\s*/);if(w)return{type:"page-margin-box",name:`${w[1]}-${w[2]}`+(w[3]?`-${w[3]}`:""),declarations:C()}}function D(){if(a(/^@font-face\s*/))return{type:"font-face",declarations:C()}}function M(){const w=a(/^@supports *([^{]+)/);if(w)return{type:"supports",supports:w[1].trim(),rules:F()}}function I(){if(a(/^@host\s*/))return{type:"host",rules:F()}}function A(){const w=a(/^@media([^{]+)*/);if(w)return{type:"media",media:(w[1]||"").trim(),rules:F()}}function O(){const w=a(/^@custom-media\s+(--[^\s]+)\s*([^{;]+);/);if(w)return{type:"custom-media",name:w[1].trim(),media:w[2].trim()}}function S(){const w=a(/^@([-\w]+)?document *([^{]+)/);if(w)return{type:"document",document:w[2].trim(),vendor:w[1]?w[1].trim():null,rules:F()}}function E(){const w=a(/^@(import|charset|namespace)\s*([^;]+);/);if(w)return{type:w[1],name:w[2].trim()}}function V(){if(u(),t[0]==="@"){const w=E()||D()||A()||k()||M()||S()||O()||I()||P()||G();if(w&&!i.preserveStatic){let L=!1;return w.declarations?L=w.declarations.some(j=>/var\(/.test(j.value)):L=(w.keyframes||w.rules||[]).some(Q=>(Q.declarations||[]).some(fe=>/var\(/.test(fe.value))),L?w:{}}return w}}function d(){if(!i.preserveStatic){const j=Oa("{","}",t);if(j){const Q=/:(?:root|host)(?![.:#(])/.test(j.pre)&&/--\S*\s*:/.test(j.body),fe=/var\(/.test(j.body);if(!Q&&!fe)return t=t.slice(j.end+1),{}}}const w=g()||[],L=i.preserveStatic?C():C().filter(j=>{const Q=w.some(te=>/:(?:root|host)(?![.:#(])/.test(te))&&/^--\S/.test(j.property),fe=/var\(/.test(j.value);return Q||fe});return w.length||r("selector missing"),{type:"rule",selectors:w,declarations:L}}function F(w){if(!w&&!l())return r("missing '{'");let L,j=p();for(;t.length&&(w||t[0]!=="}")&&(L=V()||d());)L.type&&j.push(L),j=j.concat(p());return!w&&!s()?r("missing '}'"):j}return{type:"stylesheet",stylesheet:{rules:F(!0),errors:o}}}function Va(t,e="",n){const i={charset(r){return"@charset "+r.name+";"},comment(r){return r.comment.indexOf("__CSSVARSPONYFILL")===0?"/*"+r.comment+"*/":""},"custom-media"(r){return"@custom-media "+r.name+" "+r.media+";"},declaration(r){return r.property+":"+r.value+";"},document(r){return"@"+(r.vendor||"")+"document "+r.document+"{"+o(r.rules)+"}"},"font-face"(r){return"@font-face{"+o(r.declarations)+"}"},host(r){return"@host{"+o(r.rules)+"}"},import(r){return"@import "+r.name+";"},keyframe(r){return r.values.join(",")+"{"+o(r.declarations)+"}"},keyframes(r){return"@"+(r.vendor||"")+"keyframes "+r.name+"{"+o(r.keyframes)+"}"},media(r){return"@media "+r.media+"{"+o(r.rules)+"}"},namespace(r){return"@namespace "+r.name+";"},page(r){return"@page "+(r.selectors.length?r.selectors.join(", "):"")+"{"+o(r.declarations)+"}"},"page-margin-box"(r){return"@"+r.name+"{"+o(r.declarations)+"}"},rule(r){const a=r.declarations;if(a.length)return r.selectors.join(",")+"{"+o(a)+"}"},supports(r){return"@supports "+r.supports+"{"+o(r.rules)+"}"}};function o(r){let a="";for(let l=0;l<r.length;l++){const s=r[l];n&&n(s);const u=i[s.type](s);u&&(a+=u,u.length&&s.selectors&&(a+=e))}return a}return o(t.stylesheet.rules)}const za=/\s?html\s?/gi,Ha=/\s?body\s?/gi;function Na(t,e){const i=La(t.styleSheet).stylesheet.rules.filter(o=>o.type==="rule").filter(o=>!o.selectors.some(r=>za.test(r)||Ha.test(r)));return i.forEach(o=>{const r={};o.declarations=o.declarations.filter(l=>!/line-height$/.test(l.property)&&!/text-indent$/.test(l.property));const a=new Xa(o.declarations,r);o.declarations.forEach(l=>{bn(r,Wa(l)),bn(r,ja(l)),bn(r,a.convert(l))}),Object.entries(r).forEach(([l,s])=>{o.declarations.push({type:"declaration",property:l,value:s})}),o.declarations=o.declarations.filter(l=>!/writing-mode\s*$/.test(l.property))}),i.push(qa()),i.forEach(o=>{o.selectors=Ga(o.selectors,e)}),Va({stylesheet:{rules:i},type:"stylesheet"})}function Ga(t,e){return t.map(n=>`${e} ${n}`)}function bn(t,e){return e&&(t[e.key]=e.value),t}function Wa(t){const e=/(?:(?:-epub-)|(?:-webkit-))(.+)/i.exec(t.property);if(e)return{key:e[1],value:t.value}}function ja(t){if(t.property==="font-family"){let e=t.value;return e.includes("sans-serif")?e="var(--font-family-sans-serif, Noto Sans JP, sans-serif)":e.includes("serif")&&(e="var(--font-family-serif, Noto Serif JP, serif)"),{key:t.property,value:e}}}class Xa{constructor(e,n){Ne(this,"hasLineBreakDefined");this.ruleDeclarations=e,this.newDeclarations=n}convert(e){if(/(?:(?:-epub-)|(?:-webkit-))?word-break$/i.exec(e.property)&&e.value==="break-all"&&(this.hasLineBreakDefined===void 0&&(this.hasLineBreakDefined=this.ruleDeclarations.some(n=>n.type==="declaration"&&n.property==="line-break")),!this.hasLineBreakDefined&&!this.newDeclarations["line-break"]))return{key:"line-break",value:"loose"}}}function qa(){return{type:"rule",selectors:["br"],declarations:[{type:"declaration",property:"display",value:"inline!important"}]}}function Ya(t,e,n){return Ea(t,n).pipe(Ae(i=>({htmlContent:i,styleSheet:Na(t,e)})))}function Ka(t){return new lt(e=>t.subscribe(n=>{e.next(n)}))}function qt(t=Pi){return e=>t?e:Si}function no(t,e,n){return i=>new lt(o=>{const r=t();return i.pipe(go(ln),Sr(()=>n(r))).subscribe({next:a=>{e(a,r),o.next(a)},error:a=>o.error(a),complete:()=>o.complete()})})}function Ua(t,e,n,i,o,r,a,l,s,u){switch(e[t.code]){case et.BOOKMARK:return n(),!0;case et.JUMP_TO_BOOKMARK:return i(),!0;case et.AUTO_SCROLL_TOGGLE:return r==null||r.toggle(),!0;case et.AUTO_SCROLL_INCREASE:return o(1),!0;case et.AUTO_SCROLL_DECREASE:return o(-1),!0;case et.NEXT_PAGE:return a==null||a.nextPage(),!0;case et.PREV_PAGE:return a==null||a.prevPage(),!0;case et.PREV_CHAPTER:return s(l?1:-1),!0;case et.NEXT_CHAPTER:return s(l?-1:1),!0;case et.SET_READING_POINT:return u(),!0;default:return!1}}const{document:Cn,window:Ja}=Rn;function oo(t){var p;let e,n,i,o,r,a,l,s;function u(g){t[68](g)}let c={hasChapterData:!!((p=t[21])!=null&&p.length),hasCustomReadingPoint:!!(t[24]&&(t[18]&&t[3]||!t[18]&&t[14]>-1&&t[13]>-1)),showFullscreenButton:Kt.fullscreenEnabled,autoScrollMultiplier:t[25]};return t[8]!==void 0&&(c.isBookmarkScreen=t[8]),n=new Pa({props:c}),U.push(()=>oe(n,"isBookmarkScreen",u,t[8])),n.$on("tocClick",t[69]),n.$on("setCustomReadingPoint",t[66]),n.$on("showCustomReadingPoint",t[70]),n.$on("resetCustomReadingPoint",t[71]),n.$on("fullscreenClick",t[65]),n.$on("bookmarkClick",t[63]),n.$on("bookManagerClick",t[64]),n.$on("settingsClick",t[63]),{c(){e=x("div"),Be(n.$$.fragment),this.h()},l(g){e=$(g,"DIV",{class:!0});var f=ee(e);Ee(n.$$.fragment,f),f.forEach(B),this.h()},h(){K(e,"class","elevation-4 writing-horizontal-tb fixed inset-x-0 top-0 z-10 w-full")},m(g,f){N(g,e,f),Fe(n,e,null),a=!0,l||(s=Mn(o=So.call(null,e,t[72])),l=!0)},p(g,f){var v;t=g;const C={};f[0]&2097152&&(C.hasChapterData=!!((v=t[21])!=null&&v.length)),f[0]&17063944&&(C.hasCustomReadingPoint=!!(t[24]&&(t[18]&&t[3]||!t[18]&&t[14]>-1&&t[13]>-1))),f[0]&33554432&&(C.autoScrollMultiplier=t[25]),!i&&f[0]&256&&(i=!0,C.isBookmarkScreen=t[8],ie(()=>i=!1)),n.$set(C),o&&fi(o.update)&&f[0]&128&&o.update.call(null,t[72])},i(g){a||(Y(n.$$.fragment,g),g&&fo(()=>{r||(r=An(e,vn,{y:-300,easing:Pn},!0)),r.run(1)}),a=!0)},o(g){J(n.$$.fragment,g),g&&(r||(r=An(e,vn,{y:-300,easing:Pn},!1)),r.run(0)),a=!1},d(g){g&&B(e),De(n),g&&r&&r.end(),l=!1,s()}}}function Qa(t){let e=(t[47]??"")+"",n;return{c(){n=_e(e)},l(i){n=we(i,e)},m(i,o){N(i,n,o)},p(i,o){o[1]&65536&&e!==(e=(i[47]??"")+"")&&Ge(n,e)},i:At,o:At,d(i){i&&B(n)}}}function Za(t){var me,ke,ye;let e,n,i,o,r,a,l,s,u,c,p,g,f,C,v,k,P,G=(t[43]??"")+"",D,M,I=(t[44]??"")+"",A,O,S=(t[45]??"")+"",E,V,d=(t[46]??"")+"",F,w;e=new _a({props:{styleSheet:t[26].styleSheet}});function L(_){t[73](_)}function j(_){t[74](_)}function Q(_){t[75](_)}function fe(_){t[76](_)}function te(_){t[77](_)}function Se(_){t[78](_)}function ve(_){t[79](_)}function ce(_){t[80](_)}function Pe(_){t[81](_)}function z(_){t[82](_)}function be(_){t[83](_)}function q(_){t[84](_)}function de(_){t[85](_)}let Z={htmlContent:t[26].htmlContent,width:t[27]??0,height:t[28]??0,verticalMode:t[19],fontColor:(me=t[29])==null?void 0:me.fontColor,backgroundColor:t[30],hintFuriganaFontColor:(ke=t[29])==null?void 0:ke.hintFuriganaFontColor,hintFuriganaShadowColor:(ye=t[29])==null?void 0:ye.hintFuriganaShadowColor,fontFamilyGroupOne:t[31],fontFamilyGroupTwo:t[32],fontSize:t[33],lineHeight:t[34],hideSpoilerImage:t[35],hideFurigana:t[36],furiganaStyle:t[37],viewMode:t[5],secondDimensionMaxValue:t[38],firstDimensionMargin:t[20],autoPositionOnResize:t[39],avoidPageBreak:t[40],pageColumns:t[41],autoBookmark:t[42],multiplier:t[25]};return t[0]!==void 0&&(Z.exploredCharCount=t[0]),t[1]!==void 0&&(Z.bookCharCount=t[1]),t[8]!==void 0&&(Z.isBookmarkScreen=t[8]),t[12]!==void 0&&(Z.bookmarkData=t[12]),t[2]!==void 0&&(Z.autoScroller=t[2]),t[10]!==void 0&&(Z.bookmarkManager=t[10]),t[11]!==void 0&&(Z.pageManager=t[11]),t[15]!==void 0&&(Z.customReadingPoint=t[15]),t[13]!==void 0&&(Z.customReadingPointTop=t[13]),t[14]!==void 0&&(Z.customReadingPointLeft=t[14]),t[16]!==void 0&&(Z.customReadingPointScrollOffset=t[16]),t[3]!==void 0&&(Z.customReadingPointRange=t[3]),t[4]!==void 0&&(Z.showCustomReadingPoint=t[4]),i=new pa({props:Z}),U.push(()=>oe(i,"exploredCharCount",L,t[0])),U.push(()=>oe(i,"bookCharCount",j,t[1])),U.push(()=>oe(i,"isBookmarkScreen",Q,t[8])),U.push(()=>oe(i,"bookmarkData",fe,t[12])),U.push(()=>oe(i,"autoScroller",te,t[2])),U.push(()=>oe(i,"bookmarkManager",Se,t[10])),U.push(()=>oe(i,"pageManager",ve,t[11])),U.push(()=>oe(i,"customReadingPoint",ce,t[15])),U.push(()=>oe(i,"customReadingPointTop",Pe,t[13])),U.push(()=>oe(i,"customReadingPointLeft",z,t[14])),U.push(()=>oe(i,"customReadingPointScrollOffset",be,t[16])),U.push(()=>oe(i,"customReadingPointRange",q,t[3])),U.push(()=>oe(i,"showCustomReadingPoint",de,t[4])),i.$on("bookmark",t[63]),{c(){Be(e.$$.fragment),n=se(),Be(i.$$.fragment),P=se(),D=_e(G),M=se(),A=_e(I),O=se(),E=_e(S),V=se(),F=_e(d)},l(_){Ee(e.$$.fragment,_),n=ue(_),Ee(i.$$.fragment,_),P=ue(_),D=we(_,G),M=ue(_),A=we(_,I),O=ue(_),E=we(_,S),V=ue(_),F=we(_,d)},m(_,T){Fe(e,_,T),N(_,n,T),Fe(i,_,T),N(_,P,T),N(_,D,T),N(_,M,T),N(_,A,T),N(_,O,T),N(_,E,T),N(_,V,T),N(_,F,T),w=!0},p(_,T){var Ce,pe,Oe;const ae={};T[0]&67108864&&(ae.styleSheet=_[26].styleSheet),e.$set(ae);const H={};T[0]&67108864&&(H.htmlContent=_[26].htmlContent),T[0]&134217728&&(H.width=_[27]??0),T[0]&268435456&&(H.height=_[28]??0),T[0]&524288&&(H.verticalMode=_[19]),T[0]&536870912&&(H.fontColor=(Ce=_[29])==null?void 0:Ce.fontColor),T[0]&1073741824&&(H.backgroundColor=_[30]),T[0]&536870912&&(H.hintFuriganaFontColor=(pe=_[29])==null?void 0:pe.hintFuriganaFontColor),T[0]&536870912&&(H.hintFuriganaShadowColor=(Oe=_[29])==null?void 0:Oe.hintFuriganaShadowColor),T[1]&1&&(H.fontFamilyGroupOne=_[31]),T[1]&2&&(H.fontFamilyGroupTwo=_[32]),T[1]&4&&(H.fontSize=_[33]),T[1]&8&&(H.lineHeight=_[34]),T[1]&16&&(H.hideSpoilerImage=_[35]),T[1]&32&&(H.hideFurigana=_[36]),T[1]&64&&(H.furiganaStyle=_[37]),T[0]&32&&(H.viewMode=_[5]),T[1]&128&&(H.secondDimensionMaxValue=_[38]),T[0]&1048576&&(H.firstDimensionMargin=_[20]),T[1]&256&&(H.autoPositionOnResize=_[39]),T[1]&512&&(H.avoidPageBreak=_[40]),T[1]&1024&&(H.pageColumns=_[41]),T[1]&2048&&(H.autoBookmark=_[42]),T[0]&33554432&&(H.multiplier=_[25]),!o&&T[0]&1&&(o=!0,H.exploredCharCount=_[0],ie(()=>o=!1)),!r&&T[0]&2&&(r=!0,H.bookCharCount=_[1],ie(()=>r=!1)),!a&&T[0]&256&&(a=!0,H.isBookmarkScreen=_[8],ie(()=>a=!1)),!l&&T[0]&4096&&(l=!0,H.bookmarkData=_[12],ie(()=>l=!1)),!s&&T[0]&4&&(s=!0,H.autoScroller=_[2],ie(()=>s=!1)),!u&&T[0]&1024&&(u=!0,H.bookmarkManager=_[10],ie(()=>u=!1)),!c&&T[0]&2048&&(c=!0,H.pageManager=_[11],ie(()=>c=!1)),!p&&T[0]&32768&&(p=!0,H.customReadingPoint=_[15],ie(()=>p=!1)),!g&&T[0]&8192&&(g=!0,H.customReadingPointTop=_[13],ie(()=>g=!1)),!f&&T[0]&16384&&(f=!0,H.customReadingPointLeft=_[14],ie(()=>f=!1)),!C&&T[0]&65536&&(C=!0,H.customReadingPointScrollOffset=_[16],ie(()=>C=!1)),!v&&T[0]&8&&(v=!0,H.customReadingPointRange=_[3],ie(()=>v=!1)),!k&&T[0]&16&&(k=!0,H.showCustomReadingPoint=_[4],ie(()=>k=!1)),i.$set(H),(!w||T[1]&4096)&&G!==(G=(_[43]??"")+"")&&Ge(D,G),(!w||T[1]&8192)&&I!==(I=(_[44]??"")+"")&&Ge(A,I),(!w||T[1]&16384)&&S!==(S=(_[45]??"")+"")&&Ge(E,S),(!w||T[1]&32768)&&d!==(d=(_[46]??"")+"")&&Ge(F,d)},i(_){w||(Y(e.$$.fragment,_),Y(i.$$.fragment,_),w=!0)},o(_){J(e.$$.fragment,_),J(i.$$.fragment,_),w=!1},d(_){De(e,_),_&&B(n),De(i,_),_&&B(P),_&&B(D),_&&B(M),_&&B(A),_&&B(O),_&&B(E),_&&B(V),_&&B(F)}}}function io(t){let e,n,i,o,r,a;return n=new Ma({props:{sectionData:t[21],verticalMode:t[19],exploredCharCount:t[0]}}),{c(){e=x("div"),Be(n.$$.fragment),this.h()},l(l){e=$(l,"DIV",{class:!0});var s=ee(e);Ee(n.$$.fragment,s),s.forEach(B),this.h()},h(){var l;K(e,"class","writing-horizontal-tb fixed top-0 left-0 z-[60] flex h-full w-full max-w-xl flex-col justify-between"),R(e,"color",(l=t[29])==null?void 0:l.fontColor),R(e,"background-color",t[30])},m(l,s){N(l,e,s),Fe(n,e,null),o=!0,r||(a=Mn(So.call(null,e,t[86])),r=!0)},p(l,s){var c;t=l;const u={};s[0]&2097152&&(u.sectionData=t[21]),s[0]&524288&&(u.verticalMode=t[19]),s[0]&1&&(u.exploredCharCount=t[0]),n.$set(u),s[0]&536870912&&R(e,"color",(c=t[29])==null?void 0:c.fontColor),s[0]&1073741824&&R(e,"background-color",t[30])},i(l){o||(Y(n.$$.fragment,l),l&&(i||fo(()=>{i=ci(e,vn,{x:-100,duration:100,easing:Pn}),i.start()})),o=!0)},o(l){J(n.$$.fragment,l),o=!1},d(l){l&&B(e),De(n),r=!1,a()}}}function ro(t){let e,n,i;return{c(){e=x("div"),n=se(),i=x("div"),this.h()},l(o){e=$(o,"DIV",{class:!0}),ee(e).forEach(B),n=ue(o),i=$(o,"DIV",{class:!0}),ee(i).forEach(B),this.h()},h(){K(e,"class","fixed left-0 z-20 h-[1px] w-full border border-red-500"),R(e,"top",`${t[13]}px`),K(i,"class","fixed top-0 z-20 h-full w-[1px] border border-red-500"),R(i,"left",`${t[14]}px`)},m(o,r){N(o,e,r),N(o,n,r),N(o,i,r)},p(o,r){r[0]&8192&&R(e,"top",`${o[13]}px`),r[0]&16384&&R(i,"left",`${o[14]}px`)},d(o){o&&B(e),o&&B(n),o&&B(i)}}}function ao(t){let e,n,i,o,r,a=(t[0]/t[1]*100).toFixed(2)+"",l,s;return{c(){e=x("div"),n=_e(t[0]),i=_e(" / "),o=_e(t[1]),r=_e(" ("),l=_e(a),s=_e("%)"),this.h()},l(u){e=$(u,"DIV",{class:!0});var c=ee(e);n=we(c,t[0]),i=we(c," / "),o=we(c,t[1]),r=we(c," ("),l=we(c,a),s=we(c,"%)"),c.forEach(B),this.h()},h(){var u;K(e,"class","writing-horizontal-tb fixed bottom-2 right-2 z-10 text-xs leading-none"),R(e,"color",(u=t[29])==null?void 0:u.tooltipTextFontColor)},m(u,c){N(u,e,c),re(e,n),re(e,i),re(e,o),re(e,r),re(e,l),re(e,s)},p(u,c){var p;c[0]&1&&Ge(n,u[0]),c[0]&2&&Ge(o,u[1]),c[0]&3&&a!==(a=(u[0]/u[1]*100).toFixed(2)+"")&&Ge(l,a),c[0]&536870912&&R(e,"color",(p=u[29])==null?void 0:p.tooltipTextFontColor)},d(u){u&&B(e)}}}function xa(t){var V;let e,n,i=(t[23]??"")+"",o,r,a,l,s,u,c,p,g,f,C,v,k,P,G;Cn.title=e=On(((V=t[22])==null?void 0:V.title)??"");let D=t[7]&&oo(t);const M=[Za,Qa],I=[];function A(d,F){return d[26]?0:1}u=A(t),c=I[u]=M[u](t);let O=t[6]&&io(t),S=(t[17]&&!t[48]||!t[18]&&t[4])&&ro(t),E=t[9]&&t[1]&&ao(t);return{c(){n=se(),o=_e(i),r=se(),a=x("button"),l=se(),D&&D.c(),s=se(),c.c(),p=se(),O&&O.c(),g=se(),S&&S.c(),f=se(),E&&E.c(),C=se(),v=x("button"),this.h()},l(d){ui("svelte-rnuhm6",Cn.head).forEach(B),n=ue(d),o=we(d,i),r=ue(d),a=$(d,"BUTTON",{class:!0}),ee(a).forEach(B),l=ue(d),D&&D.l(d),s=ue(d),c.l(d),p=ue(d),O&&O.l(d),g=ue(d),S&&S.l(d),f=ue(d),E&&E.l(d),C=ue(d),v=$(d,"BUTTON",{class:!0}),ee(v).forEach(B),this.h()},h(){K(a,"class","fixed inset-x-0 top-0 z-10 h-8 w-full"),K(v,"class","fixed inset-x-0 bottom-0 z-10 h-8 w-full cursor-pointer")},m(d,F){N(d,n,F),N(d,o,F),N(d,r,F),N(d,a,F),N(d,l,F),D&&D.m(d,F),N(d,s,F),I[u].m(d,F),N(d,p,F),O&&O.m(d,F),N(d,g,F),S&&S.m(d,F),N(d,f,F),E&&E.m(d,F),N(d,C,F),N(d,v,F),k=!0,P||(G=[We(Ja,"keydown",t[62]),We(a,"click",t[67]),We(v,"click",t[87])],P=!0)},p(d,F){var L;(!k||F[0]&4194304)&&e!==(e=On(((L=d[22])==null?void 0:L.title)??""))&&(Cn.title=e),(!k||F[0]&8388608)&&i!==(i=(d[23]??"")+"")&&Ge(o,i),d[7]?D?(D.p(d,F),F[0]&128&&Y(D,1)):(D=oo(d),D.c(),Y(D,1),D.m(s.parentNode,s)):D&&(it(),J(D,1,1,()=>{D=null}),rt());let w=u;u=A(d),u===w?I[u].p(d,F):(it(),J(I[w],1,1,()=>{I[w]=null}),rt(),c=I[u],c?c.p(d,F):(c=I[u]=M[u](d),c.c()),Y(c,1),c.m(p.parentNode,p)),d[6]?O?(O.p(d,F),F[0]&64&&Y(O,1)):(O=io(d),O.c(),Y(O,1),O.m(g.parentNode,g)):O&&(it(),J(O,1,1,()=>{O=null}),rt()),d[17]&&!d[48]||!d[18]&&d[4]?S?S.p(d,F):(S=ro(d),S.c(),S.m(f.parentNode,f)):S&&(S.d(1),S=null),d[9]&&d[1]?E?E.p(d,F):(E=ao(d),E.c(),E.m(C.parentNode,C)):E&&(E.d(1),E=null)},i(d){k||(Y(D),Y(c),Y(O),k=!0)},o(d){J(D),J(c),J(O),k=!1},d(d){d&&B(n),d&&B(o),d&&B(r),d&&B(a),d&&B(l),D&&D.d(d),d&&B(s),I[u].d(d),d&&B(p),O&&O.d(d),d&&B(g),S&&S.d(d),d&&B(f),E&&E.d(d),d&&B(C),d&&B(v),P=!1,yt(G)}}}const lo="background-color",so="writing-mode";function $a(t,e,n){let i,o,r,a,l,s,u,c,p,g,f,C,v,k,P,G,D,M,I,A,O,S,E,V,d,F,w,L,j,Q,fe,te,Se,ve,ce,Pe;X(t,Fi,h=>n(19,o=h)),X(t,ko,h=>n(20,r=h)),X(t,po,h=>n(90,l=h)),X(t,Di,h=>n(5,s=h)),X(t,St,h=>n(6,u=h)),X(t,gn,h=>n(91,c=h)),X(t,kn,h=>n(92,p=h)),X(t,mo,h=>n(24,C=h)),X(t,pn,h=>n(25,v=h)),X(t,Ti,h=>n(31,I=h)),X(t,Ii,h=>n(32,A=h)),X(t,Ai,h=>n(33,O=h)),X(t,Oi,h=>n(34,S=h)),X(t,Li,h=>n(35,E=h)),X(t,Vi,h=>n(36,V=h)),X(t,zi,h=>n(37,d=h)),X(t,Hi,h=>n(38,F=h)),X(t,Ni,h=>n(39,w=h)),X(t,Gi,h=>n(40,L=h)),X(t,Wi,h=>n(41,j=h)),X(t,ji,h=>n(42,Q=h)),X(t,Bn,h=>n(48,Pe=h));let z=!0,be=!1,q=!0,de=0,Z=0,me,ke,ye,_=Promise.resolve(void 0),T=-2,ae=-2,H=o?p:c,Ce=0,pe,Oe,Ie=!0,Me=!1,Le=!1;const Ue=sn(2500).pipe(ot(()=>n(7,z=!1)),pt());X(t,Ue,h=>n(23,f=h));const Ve=Ct(()=>Ka(Xi)).pipe(Ae(h=>Number(h.url.searchParams.get("id"))),wn({refCount:!0,bufferSize:1})),je=Ve.pipe(Ot(h=>Et.getData(h)),Sn());X(t,je,h=>n(22,g=h));const Te=je.pipe(ot(h=>{h||Bi("/manage")}),pt());X(t,Te,h=>n(47,ce=h));const st=je.pipe(ot(h=>{!h||n(12,_=Et.getBookmark(h.id))}),pt());X(t,st,h=>n(43,fe=h));const Je=je.pipe(Ot(h=>h?(h.lastBookOpen=new Date().getTime(),vi(yi.BROWSER,window).then(ge=>Et.upsertData(h,ge)).catch(()=>{}),Fn.next(h.sections||[]),Ya(h,".book-content",document)):vt),wn({refCount:!0,bufferSize:1}));X(t,Je,h=>n(26,k=h));const ut=Ct(()=>visualViewport?Ke(visualViewport,"resize"):En()).pipe(Sn()),nt=ut.pipe(_n(0),Ae(()=>(visualViewport==null?void 0:visualViewport.width)||0),qt());X(t,nt,h=>n(27,P=h));const xe=ut.pipe(_n(0),Ae(()=>(visualViewport==null?void 0:visualViewport.height)||0),qt());X(t,xe,h=>n(28,G=h));const $e=Ri.pipe(Ae(h=>or.get(h)),on(h=>!!h));X(t,$e,h=>n(29,D=h));const y=$e.pipe(Ae(h=>h.backgroundColor));X(t,y,h=>n(30,M=h));const he=y.pipe(no(()=>document.body,(h,ge)=>ge.style.setProperty(lo,h),h=>h.style.removeProperty(lo)),pt(),qt());X(t,he,h=>n(44,te=h));const ze=Mi.pipe(no(()=>document.documentElement,(h,ge)=>ge.style.setProperty(so,h),h=>h.style.removeProperty(so)),pt(),qt());X(t,ze,h=>n(45,Se=h));const Re=Ct(()=>$t).pipe(Ae(h=>[...h.values()]));X(t,Re,h=>n(21,a=h));const b=Ct(()=>Ke(document,"selectionchange")).pipe(Ht(200),ot(()=>{var ge,He;const h=((ge=window.getSelection())==null?void 0:ge.toString())||"";!h&&Ie?Oe=void 0:h?(Oe=(He=window.getSelection())==null?void 0:He.getRangeAt(0),Ie=!1):Ie=!0}),pt());X(t,b,h=>n(46,ve=h));function ne(h){!Ua(h,Ei.getValue(),qe,un,He=>pn.next(pn.getValue()+He),me,ye,o,hn,m)||(document.activeElement instanceof HTMLElement&&document.activeElement.blur(),h.preventDefault())}function le(){let h;return Ve.subscribe(ge=>h=ge).unsubscribe(),h}async function qe(){var He;const h=le();if(!h||!ke)return;let ge;if(n(7,z=!1),i){const Bt=l?Fr(window,Oe):void 0,kt=Bt||pe;Dt((He=kt==null?void 0:kt.endContainer)==null?void 0:He.parentElement,"add",.5,500),ge=ke.formatBookmarkDataByRange(h,kt),Bt&&Fo(window)}else ge=ke.formatBookmarkData(h,Ce);await Et.putBookmark(ge),n(12,_=Promise.resolve(ge))}async function un(){const h=await _;!h||!ke||ke.scrollToBookmark(h,Ce)}function fn(){Et.deleteLastItem(),qe()}function cn(){if(n(7,z=!1),!Kt.fullscreenElement){Kt.requestFullscreen(document.documentElement);return}Kt.exitFullscreen()}function hn(h){if(!(a!=null&&a.length))return;const[ge,He]=Bo(a);!He&&h===-1||h===1&&He===ge.length-1||Wt.next(ge[He+h].reference)}function m(){const h=document.querySelector(".book-content");if(!h)return;i&&(n(13,T=window.innerHeight/2-2),n(14,ae=window.innerWidth/2-2)),n(7,z=!1),n(17,Me=!0),document.body.classList.add("cursor-crosshair");const{elLeftReferencePoint:ge,elTopReferencePoint:He,elRightReferencePoint:Bt,elBottomReferencePoint:kt,pointGap:Tn}=Do(window,h,o,r);Gt(Ke(document,"pointerup"),Ke(document,"pointermove")).pipe(vr(()=>Me)).subscribe(Qe=>{if(Qe instanceof PointerEvent)if(Qe.type==="pointerup")document.body.classList.remove("cursor-crosshair"),n(17,Me=!1),hi().then(()=>{n(14,ae=o?Qe.x:ae),n(13,T=o?T:Qe.y);const ft=Er(ae,T);if(ft&&Dt(ft.parent,"add",.5,500),i)n(3,pe=ft==null?void 0:ft.range);else{let ct=0;o?(ct=Math.ceil(Math.max(0,ae-ge)/(Bt-ge)*100),kn.next(ct)):(ct=Math.ceil(Math.max(0,T-He)/(kt-He)*100),gn.next(ct)),n(15,H=ct)}});else{const ft=Qe.x>=ge+Tn&&Qe.x<=Bt,ct=Qe.y>=He&&Qe.y<=kt-Tn;i?(n(13,T=ct?Qe.y:T),n(14,ae=ft?Qe.x:ae)):o&&ft?n(14,ae=Qe.x):!o&&ct&&n(13,T=Qe.y)}})}const dn=()=>n(7,z=!0);function mn(h){be=h,n(8,be)}const Vo=()=>{n(7,z=!1),St.next(!0)},zo=()=>{n(7,z=!1),n(4,Le=!0)},Ho=()=>{n(7,z=!1),i?n(3,pe=void 0):o?(kn.next(100),n(15,H=100)):(gn.next(0),n(15,H=0))},No=()=>n(7,z=!1);function Go(h){de=h,n(0,de)}function Wo(h){Z=h,n(1,Z)}function jo(h){be=h,n(8,be)}function Xo(h){_=h,n(12,_)}function qo(h){me=h,n(2,me)}function Yo(h){ke=h,n(10,ke)}function Ko(h){ye=h,n(11,ye)}function Uo(h){H=h,n(15,H)}function Jo(h){T=h,n(13,T)}function Qo(h){ae=h,n(14,ae)}function Zo(h){Ce=h,n(16,Ce)}function xo(h){pe=h,n(3,pe)}function $o(h){Le=h,n(4,Le),n(3,pe)}const ei=()=>St.next(!1),ti=()=>n(9,q=!q);return t.$$.update=()=>{var h;t.$$.dirty[0]&68&&u&&(me==null||me.off()),t.$$.dirty[0]&3&&Z&&document.dispatchEvent(new CustomEvent("ttsu:page.change",{detail:{exploredCharCount:de}})),t.$$.dirty[0]&2&&document.dispatchEvent(new CustomEvent("ttsu:page.change",{detail:{bookCharCount:Z}})),t.$$.dirty[0]&24&&Le&&(Dt((h=pe==null?void 0:pe.endContainer)==null?void 0:h.parentElement,"add",1),Ke(document,"click").pipe(Ut(1),Mt(1)).subscribe(()=>{var ge;n(4,Le=!1),Dt((ge=pe==null?void 0:pe.endContainer)==null?void 0:ge.parentElement,"remove",1)})),t.$$.dirty[0]&32&&n(18,i=s===Tt.Paginated)},[de,Z,me,pe,Le,s,u,z,be,q,ke,ye,_,T,ae,H,Ce,Me,i,o,r,a,g,f,C,v,k,P,G,D,M,I,A,O,S,E,V,d,F,w,L,j,Q,fe,te,Se,ve,ce,Pe,Ue,je,Te,st,Je,nt,xe,$e,y,he,ze,Re,b,ne,qe,fn,cn,m,dn,mn,Vo,zo,Ho,No,Go,Wo,jo,Xo,qo,Yo,Ko,Uo,Jo,Qo,Zo,xo,$o,ei,ti]}class ul extends ht{constructor(e){super(),dt(this,e,$a,xa,mt,{},null,[-1,-1,-1,-1])}}export{ul as default};
